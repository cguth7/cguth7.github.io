<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Riemann-Roch Formalization</title>
    <link href="https://fonts.googleapis.com/css2?family=CMU+Serif:wght@400;700&family=JetBrains+Mono:wght@400;600&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #fafafa;
            --text: #1a1a1a;
            --muted: #666;
            --border: #ddd;
            --accent: #2563eb;
            --green: #16a34a;
            --yellow: #ca8a04;
            --red: #dc2626;
            --code-bg: #f3f4f6;
            --math-bg: #f8fafc;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            font-size: 16px;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 3rem 2rem;
        }

        header {
            margin-bottom: 3rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid var(--border);
        }

        header h1 {
            font-size: 1.75rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        header p {
            color: var(--muted);
            font-size: 0.95rem;
        }

        header a {
            color: var(--accent);
            text-decoration: none;
        }

        section {
            margin-bottom: 3rem;
        }

        h2 {
            font-size: 1.1rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--muted);
            margin-bottom: 1.5rem;
        }

        h3 {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
        }

        .theorem-box {
            background: var(--math-bg);
            border: 1px solid var(--border);
            border-left: 3px solid var(--accent);
            padding: 1.5rem 2rem;
            margin-bottom: 2rem;
        }

        .theorem-box .label {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--accent);
            margin-bottom: 0.75rem;
        }

        .theorem-box .equation {
            font-family: 'Times New Roman', Georgia, serif;
            font-size: 1.5rem;
            font-style: italic;
            text-align: center;
            padding: 1rem 0;
        }

        .theorem-box .gloss {
            font-size: 0.9rem;
            color: var(--muted);
            text-align: center;
        }

        .theorem-box.green {
            border-left-color: var(--green);
        }
        .theorem-box.green .label {
            color: var(--green);
        }

        .two-col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .approach-box {
            padding: 1.5rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: white;
        }

        .approach-box h4 {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .approach-box .file {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            background: var(--code-bg);
            padding: 0.2rem 0.5rem;
            border-radius: 3px;
        }

        .approach-box ul {
            font-size: 0.9rem;
            margin-left: 1.25rem;
            margin-bottom: 0.75rem;
        }

        .approach-box li {
            margin-bottom: 0.25rem;
        }

        .approach-box code {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            background: var(--code-bg);
            padding: 0.1rem 0.3rem;
            border-radius: 3px;
        }

        .stats-row {
            display: flex;
            gap: 2rem;
            padding: 1.5rem 0;
            border-top: 1px solid var(--border);
            border-bottom: 1px solid var(--border);
            margin-bottom: 2rem;
        }

        .stat {
            text-align: center;
        }

        .stat-num {
            font-size: 2rem;
            font-weight: 600;
            color: var(--text);
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .status-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .status-table th {
            text-align: left;
            padding: 0.75rem 1rem;
            background: var(--code-bg);
            border-bottom: 1px solid var(--border);
            font-weight: 600;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .status-table td {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border);
            vertical-align: top;
        }

        .status-table code {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            background: var(--code-bg);
            padding: 0.1rem 0.4rem;
            border-radius: 3px;
        }

        .status {
            display: inline-block;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            padding: 0.2rem 0.5rem;
            border-radius: 3px;
        }

        .status.done { background: #dcfce7; color: var(--green); }
        .status.wip { background: #fef3c7; color: var(--yellow); }
        .status.blocked { background: #fee2e2; color: var(--red); }
        .status.obsolete { background: #e5e7eb; color: #6b7280; text-decoration: line-through; }

        .note {
            background: #fffbeb;
            border: 1px solid #fcd34d;
            border-radius: 6px;
            padding: 1rem 1.25rem;
            font-size: 0.9rem;
            margin: 1rem 0;
        }

        .note strong {
            color: var(--yellow);
        }

        .note.info {
            background: #eff6ff;
            border-color: #93c5fd;
        }
        .note.info strong {
            color: var(--accent);
        }

        .note.success {
            background: #dcfce7;
            border-color: #86efac;
        }
        .note.success strong {
            color: var(--green);
        }

        .difficulty-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
            margin: 1rem 0;
        }

        .difficulty-table th, .difficulty-table td {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border);
            text-align: left;
        }

        .difficulty-table th {
            background: var(--code-bg);
            font-weight: 600;
            font-size: 0.8rem;
            text-transform: uppercase;
        }

        .difficulty {
            display: inline-block;
            font-size: 0.75rem;
            font-weight: 600;
            padding: 0.2rem 0.5rem;
            border-radius: 3px;
        }

        .difficulty.easy { background: #dcfce7; color: var(--green); }
        .difficulty.medium { background: #fef3c7; color: var(--yellow); }
        .difficulty.hard { background: #fee2e2; color: var(--red); }
        .difficulty.very-hard { background: #fce7f3; color: #be185d; }

        footer {
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border);
            font-size: 0.85rem;
            color: var(--muted);
        }

        footer a {
            color: var(--accent);
            text-decoration: none;
        }

        @media (max-width: 768px) {
            .two-col {
                grid-template-columns: 1fr;
            }
            .stats-row {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Formalizing Riemann-Roch in Lean 4</h1>
            <p>
                A work-in-progress formalization of the Riemann-Roch theorem for algebraic curves.
                <a href="https://github.com/cguth7/roch-riemann">Source on GitHub</a>
            </p>
        </header>

        <!-- Target Theorem -->
        <section>
            <h2>Target Theorem</h2>
            <div class="theorem-box">
                <div class="label">Riemann-Roch</div>
                <div class="equation">
                    l(D) - l(K - D) = deg(D) + 1 - g
                </div>
                <div class="gloss">
                    For a divisor D on a smooth projective curve of genus g, with canonical divisor K
                </div>
            </div>
        </section>

        <!-- Stats -->
        <section>
            <div class="stats-row">
                <div class="stat">
                    <div class="stat-num">53</div>
                    <div class="stat-label">Cycles</div>
                </div>
                <div class="stat">
                    <div class="stat-num">7</div>
                    <div class="stat-label">Modules</div>
                </div>
                <div class="stat">
                    <div class="stat-num">200+</div>
                    <div class="stat-label">Lemmas Proved</div>
                </div>
                <div class="stat">
                    <div class="stat-num">~40</div>
                    <div class="stat-label">Sorries Left</div>
                </div>
            </div>
        </section>

        <!-- Codebase Structure -->
        <section>
            <h2>Codebase Structure (Modularized Cycle 40)</h2>
            <div class="two-col">
                <div class="approach-box">
                    <h4><span class="file">RrLean/RiemannRochV2/</span> Main Modules</h4>
                    <ul>
                        <li><code>Basic.lean</code> &mdash; Shared imports</li>
                        <li><code>Divisor.lean</code> &mdash; DivisorV2</li>
                        <li><code>RRSpace.lean</code> &mdash; L(D), l(D)</li>
                        <li><code>Typeclasses.lean</code> &mdash; LocalGapBound</li>
                        <li><code>RiemannInequality.lean</code> &mdash; Main theorems</li>
                        <li><code>Infrastructure.lean</code> &mdash; Residue, uniformizer</li>
                        <li><code>LocalGapInstance.lean</code> &mdash; ~2200 lines WIP</li>
                    </ul>
                </div>
                <div class="approach-box">
                    <h4><span class="file">state/</span> Project State</h4>
                    <ul>
                        <li><code>ledger.md</code> &mdash; Cycle history (1-53)</li>
                        <li><code>playbook.md</code> &mdash; Strategy & heuristics</li>
                        <li><code>candidates.json</code> &mdash; Next priorities</li>
                    </ul>
                    <p style="font-size: 0.85rem; color: var(--muted); margin-top: 1rem;">
                        <strong>Note:</strong> Dead-end code marked OBSOLETE in Cycle 53 consolidation.
                    </p>
                </div>
            </div>
        </section>

        <!-- What We Have -->
        <section>
            <h2>What We Have (Proved)</h2>

            <div class="theorem-box green">
                <div class="label">Proved: Riemann Inequality (Cycle 21)</div>
                <div class="equation">
                    l(D) &le; deg(D) + 1
                </div>
                <div class="gloss">
                    For effective divisors D on a complete curve (uses SinglePointBound typeclass)
                </div>
            </div>

            <div class="theorem-box green">
                <div class="label">Proved: Affine Riemann Inequality (Cycle 23)</div>
                <div class="equation">
                    l(D) &le; deg(D) + l(0)
                </div>
                <div class="gloss">
                    For affine models where l(0) may be infinite (uses LocalGapBound + BaseDim)
                </div>
            </div>

            <h3 style="margin-top: 1.5rem;">Key Infrastructure (Victory Path)</h3>
            <table class="status-table">
                <thead>
                    <tr>
                        <th>Component</th>
                        <th>Definition</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>dvr_intValuation_eq_via_pow_membership</code></td>
                        <td>intValuation bridge via ideal power characterization</td>
                        <td><span class="status done">Cycle 46</span></td>
                    </tr>
                    <tr>
                        <td><code>dvr_intValuation_of_algebraMap'</code></td>
                        <td>DVR intVal = v.intVal (both cases)</td>
                        <td><span class="status done">Cycle 47</span></td>
                    </tr>
                    <tr>
                        <td><code>dvr_valuation_eq_height_one'</code></td>
                        <td>DVR valuation = HeightOneSpectrum valuation</td>
                        <td><span class="status done">Cycle 49</span></td>
                    </tr>
                    <tr>
                        <td><code>valuationRingAt_equiv_localization'</code></td>
                        <td>Ring equivalence via ValuationSubring equality</td>
                        <td><span class="status done">Cycle 50</span></td>
                    </tr>
                    <tr>
                        <td><code>residueField_transport_direct</code></td>
                        <td>Residue field transport via mapEquiv</td>
                        <td><span class="status done">Cycle 52</span></td>
                    </tr>
                    <tr>
                        <td><code>residueFieldBridge_explicit</code></td>
                        <td>valuationRingAt.residueField ~ residueFieldAtPrime</td>
                        <td><span class="status done">Cycle 52</span></td>
                    </tr>
                    <tr>
                        <td><code>shifted_element_valuation_le_one</code></td>
                        <td>v(f * pi^{D(v)+1}) &le; 1 for f in L(D+v)</td>
                        <td><span class="status wip">NEXT TARGET</span></td>
                    </tr>
                    <tr>
                        <td><code>evaluationMapAt_via_bridge</code></td>
                        <td>L(D+v) &rarr; residueFieldAtPrime R v</td>
                        <td><span class="status blocked">Blocked by above</span></td>
                    </tr>
                    <tr style="opacity: 0.5;">
                        <td><code>residueMapFromR_surjective</code></td>
                        <td>R is dense in valuation ring mod maxIdeal</td>
                        <td><span class="status obsolete">OBSOLETE</span></td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- Current Status -->
        <section>
            <h2>Current Status: Near Victory</h2>

            <div class="note success">
                <strong>Cycle 52 Breakthrough:</strong> Discovered <code>IsLocalRing.ResidueField.mapEquiv</code> in mathlib!
                This elegant one-liner proved <code>residueFieldBridge</code> without needing the complex
                surjectivity argument we'd been pursuing for 20+ cycles.
            </div>

            <div class="note info">
                <strong>Cycle 53 Consolidation:</strong> Marked dead-end approaches as OBSOLETE after
                cross-checking with Gemini. The old path (<code>residueMapFromR_surjective</code> &rarr; First Isomorphism Theorem)
                was completely bypassed by the mapEquiv discovery. Victory path is now clear and narrow.
            </div>

            <h3>Victory Path (Corrected Cycle 53)</h3>
            <pre style="background: var(--code-bg); padding: 1rem; border-radius: 6px; overflow-x: auto; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">
residueFieldBridge_explicit (Cycle 52 - PROVED)
    |
shifted_element_valuation_le_one  <-- ACTUAL NEXT TARGET
    | (proves f * pi^{D(v)+1} lands in valuationRingAt)
evaluationMapAt_via_bridge
    |
kernel_evaluationMapAt = L(D)
    |
LocalGapBound instance --> VICTORY</pre>

            <h3 style="margin-top: 1.5rem;">Remaining Work</h3>
            <ul style="margin: 1rem 0; padding-left: 1.5rem;">
                <li><strong>shifted_element_valuation_le_one</strong> &mdash; Valuation arithmetic with <code>WithZero.exp</code></li>
                <li><strong>evaluationMapAt_via_bridge</strong> &mdash; Now unblocked by residueFieldBridge!</li>
                <li><strong>kernel characterization</strong> &mdash; ker(eval) = L(D)</li>
                <li><strong>LocalGapBound instance</strong> &mdash; Final target for affine RR</li>
            </ul>
        </section>

        <!-- Build Progress -->
        <section>
            <h2>Build Progress by Cycle</h2>
            <table class="status-table">
                <thead>
                    <tr>
                        <th>Cycle</th>
                        <th>Focus</th>
                        <th>Key Results</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>1-16</td>
                        <td>Axiom-based RR.lean</td>
                        <td>Full RR structure, genus formulas, Clifford</td>
                        <td><span class="status done">70+ proved</span></td>
                    </tr>
                    <tr>
                        <td>17-23</td>
                        <td>Constructive RR_v2.lean</td>
                        <td><code>RRModuleV2</code>, <code>riemann_inequality_real</code>, typeclasses</td>
                        <td><span class="status done">40+ proved</span></td>
                    </tr>
                    <tr>
                        <td>24-30</td>
                        <td>Valuation infrastructure</td>
                        <td>Uniformizer, valuation ring, residue map, kernel proofs</td>
                        <td><span class="status done">35+ proved</span></td>
                    </tr>
                    <tr>
                        <td>31-40</td>
                        <td>DVR & modularization</td>
                        <td>DVR instance, IsFractionRing, split into 7 modules</td>
                        <td><span class="status done">30+ proved</span></td>
                    </tr>
                    <tr>
                        <td>41</td>
                        <td>Foundation lemmas</td>
                        <td>8/8 foundation lemmas PROVED</td>
                        <td><span class="status done">8/8</span></td>
                    </tr>
                    <tr>
                        <td>44-45</td>
                        <td>Root blocker</td>
                        <td><code>Ideal.IsPrime.mul_mem_pow</code> discovery</td>
                        <td><span class="status done">Root blocker</span></td>
                    </tr>
                    <tr>
                        <td>46</td>
                        <td>intValuation bridge</td>
                        <td><code>dvr_intValuation_eq_via_pow_membership</code></td>
                        <td><span class="status done">Key bridge</span></td>
                    </tr>
                    <tr>
                        <td>47-49</td>
                        <td>Valuation equality</td>
                        <td><code>dvr_valuation_eq_height_one'</code> deployed</td>
                        <td><span class="status done">Cascade unblocked</span></td>
                    </tr>
                    <tr>
                        <td>50</td>
                        <td>Ring equivalence</td>
                        <td><code>valuationRingAt_equiv_localization'</code></td>
                        <td><span class="status done">RingEquiv</span></td>
                    </tr>
                    <tr>
                        <td>52</td>
                        <td>residueFieldBridge</td>
                        <td>7/8 candidates via <code>mapEquiv</code> discovery</td>
                        <td><span class="status done">Breakthrough!</span></td>
                    </tr>
                    <tr>
                        <td>53</td>
                        <td>Consolidation</td>
                        <td>Dead code culled, victory path corrected</td>
                        <td><span class="status done">Cleanup</span></td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- What's Next -->
        <section>
            <h2>What's Next (Cycle 54)</h2>
            <h3>Immediate Goal</h3>
            <ul style="margin: 1rem 0; padding-left: 1.5rem;">
                <li><strong>Prove <code>shifted_element_valuation_le_one</code></strong> (Infrastructure.lean:274)</li>
            </ul>

            <h3 style="margin-top: 1.5rem;">Proof Strategy</h3>
            <ul style="margin: 1rem 0; padding-left: 1.5rem;">
                <li>f in L(D+v) means v(f) &le; exp(D(v)+1)</li>
                <li>Uniformizer: v(pi^{D(v)+1}) = exp(-(D(v)+1))</li>
                <li>Product: v(f * pi^{D(v)+1}) &le; exp(D(v)+1) * exp(-(D(v)+1)) = 1</li>
                <li>Technical: <code>WithZero.exp</code> arithmetic, case analysis on D(v)+1 sign</li>
            </ul>

            <h3 style="margin-top: 1.5rem;">After LocalGapBound</h3>
            <ul style="margin: 1rem 0; padding-left: 1.5rem;">
                <li><strong>Compactification</strong> &mdash; Add infinite places to get l(0) = 1</li>
                <li><strong>Serre duality</strong> &mdash; Would require differentials, residue map, residue theorem</li>
                <li><strong>Full Riemann-Roch</strong> &mdash; l(D) - l(K-D) = deg(D) + 1 - g</li>
            </ul>
        </section>

        <!-- Meta: Process -->
        <section>
            <h2>Meta: How This Project Evolved</h2>

            <p style="margin-bottom: 1.5rem;">
                This project uses an <strong>ACE-style orchestration loop</strong>: an LLM (Claude) guided by
                a human through iterative "cycles" of planning, implementation, and review. Each cycle
                targets a specific edge of the proof graph, builds it, tests it, and commits.
            </p>

            <h3>Key Pivots</h3>
            <table class="status-table">
                <thead>
                    <tr>
                        <th>Cycle</th>
                        <th>Discovery</th>
                        <th>Response</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>17</td>
                        <td>Axiom approach hit ceiling</td>
                        <td>Created RR_v2.lean with Dedekind domain foundations</td>
                    </tr>
                    <tr>
                        <td>22</td>
                        <td>HeightOneSpectrum = finite places only</td>
                        <td>Split into LocalGapBound (affine) + SinglePointBound (projective)</td>
                    </tr>
                    <tr>
                        <td>37</td>
                        <td>Found mathlib's <code>exists_lift_of_le_one</code></td>
                        <td>Complete proof structure via DVR valuation comparison</td>
                    </tr>
                    <tr>
                        <td>45</td>
                        <td>Found <code>Ideal.IsPrime.mul_mem_pow</code></td>
                        <td>ROOT BLOCKER resolved, ideal power membership proved</td>
                    </tr>
                    <tr>
                        <td>52</td>
                        <td>Found <code>IsLocalRing.ResidueField.mapEquiv</code></td>
                        <td>residueFieldBridge proved in one line, bypassing 20+ cycles of work</td>
                    </tr>
                    <tr>
                        <td>53</td>
                        <td>Gemini analysis: "hallucinated dependency bloat"</td>
                        <td>Consolidation cycle: marked dead-end code OBSOLETE, corrected victory path</td>
                    </tr>
                </tbody>
            </table>

            <h3 style="margin-top: 1.5rem;">Multi-LLM Collaboration (Cycle 53)</h3>
            <p style="margin-bottom: 1rem;">
                An interesting development: we consulted Google's Gemini for a "second opinion" on the codebase.
                Gemini correctly diagnosed that accumulated dead-end sorries were causing "hallucinated dependency bloat"
                &mdash; where future LLM loops might waste cycles trying to prove obsolete lemmas instead of focusing
                on the real victory path.
            </p>
            <p style="margin-bottom: 1rem;">
                However, Gemini's suggested next target (<code>residueMapFromR_surjective</code>) was itself obsolete!
                The Cycle 52 <code>mapEquiv</code> discovery had already bypassed that entire approach. This led to
                a consolidation cycle where we marked dead code and corrected the victory path documentation.
            </p>
            <p style="color: var(--muted);">
                <strong>Lesson:</strong> Cross-checking with multiple LLMs can surface structural issues (like sorry bloat),
                but always verify against the actual codebase state &mdash; documentation can lag behind breakthroughs.
            </p>

            <h3 style="margin-top: 1.5rem;">Honest Assessment</h3>
            <p style="margin-bottom: 1rem;">
                <strong>What we achieved:</strong> A working proof of the Riemann inequality from Dedekind domain
                foundations, plus a complete axiom-based development of RR consequences. The core algebraic machinery
                is solid, and we're ~3-4 lemmas away from completing the LocalGapBound instance.
            </p>
            <p style="margin-bottom: 1rem;">
                <strong>What's missing for "real" RR:</strong> The l(K-D) term requires Serre duality, which requires
                differentials, residues, and the residue theorem. This is substantial algebraic geometry that
                mathlib doesn't have yet.
            </p>
            <p style="color: var(--muted);">
                <strong>Bottom line:</strong> This is an honest partial formalization. We proved the "easy half"
                (Riemann inequality) constructively and axiomatized the "hard half" (duality). The axiom-based
                results are mathematically valid conditional on RR holding; the constructive results are unconditional.
            </p>
        </section>

        <footer>
            <p>
                Lean 4 + mathlib &bull;
                <a href="https://github.com/cguth7/roch-riemann">GitHub</a> &bull;
                Cycle 53 &bull;
                Last updated: Dec 17, 2025
            </p>
        </footer>
    </div>
</body>
</html>
