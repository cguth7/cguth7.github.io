<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Riemann-Roch Formalization</title>
    <link href="https://fonts.googleapis.com/css2?family=CMU+Serif:wght@400;700&family=JetBrains+Mono:wght@400;600&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #fafafa;
            --text: #1a1a1a;
            --muted: #666;
            --border: #ddd;
            --accent: #2563eb;
            --green: #16a34a;
            --yellow: #ca8a04;
            --red: #dc2626;
            --code-bg: #f3f4f6;
            --math-bg: #f8fafc;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            font-size: 16px;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 3rem 2rem;
        }

        header {
            margin-bottom: 3rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid var(--border);
        }

        header h1 {
            font-size: 1.75rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        header p {
            color: var(--muted);
            font-size: 0.95rem;
        }

        header a {
            color: var(--accent);
            text-decoration: none;
        }

        section {
            margin-bottom: 3rem;
        }

        h2 {
            font-size: 1.1rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--muted);
            margin-bottom: 1.5rem;
        }

        h3 {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
        }

        .theorem-box {
            background: var(--math-bg);
            border: 1px solid var(--border);
            border-left: 3px solid var(--accent);
            padding: 1.5rem 2rem;
            margin-bottom: 2rem;
        }

        .theorem-box .label {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--accent);
            margin-bottom: 0.75rem;
        }

        .theorem-box .equation {
            font-family: 'Times New Roman', Georgia, serif;
            font-size: 1.5rem;
            font-style: italic;
            text-align: center;
            padding: 1rem 0;
        }

        .theorem-box .gloss {
            font-size: 0.9rem;
            color: var(--muted);
            text-align: center;
        }

        .theorem-box.green {
            border-left-color: var(--green);
        }
        .theorem-box.green .label {
            color: var(--green);
        }

        .two-col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .approach-box {
            padding: 1.5rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: white;
        }

        .approach-box h4 {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .approach-box .file {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            background: var(--code-bg);
            padding: 0.2rem 0.5rem;
            border-radius: 3px;
        }

        .approach-box ul {
            font-size: 0.9rem;
            margin-left: 1.25rem;
            margin-bottom: 0.75rem;
        }

        .approach-box li {
            margin-bottom: 0.25rem;
        }

        .approach-box code {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            background: var(--code-bg);
            padding: 0.1rem 0.3rem;
            border-radius: 3px;
        }

        .stats-row {
            display: flex;
            gap: 2rem;
            padding: 1.5rem 0;
            border-top: 1px solid var(--border);
            border-bottom: 1px solid var(--border);
            margin-bottom: 2rem;
        }

        .stat {
            text-align: center;
        }

        .stat-num {
            font-size: 2rem;
            font-weight: 600;
            color: var(--text);
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .status-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .status-table th {
            text-align: left;
            padding: 0.75rem 1rem;
            background: var(--code-bg);
            border-bottom: 1px solid var(--border);
            font-weight: 600;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .status-table td {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border);
            vertical-align: top;
        }

        .status-table code {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            background: var(--code-bg);
            padding: 0.1rem 0.4rem;
            border-radius: 3px;
        }

        .status {
            display: inline-block;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            padding: 0.2rem 0.5rem;
            border-radius: 3px;
        }

        .status.done { background: #dcfce7; color: var(--green); }
        .status.wip { background: #fef3c7; color: var(--yellow); }
        .status.blocked { background: #fee2e2; color: var(--red); }

        .note {
            background: #fffbeb;
            border: 1px solid #fcd34d;
            border-radius: 6px;
            padding: 1rem 1.25rem;
            font-size: 0.9rem;
            margin: 1rem 0;
        }

        .note strong {
            color: var(--yellow);
        }

        .note.info {
            background: #eff6ff;
            border-color: #93c5fd;
        }
        .note.info strong {
            color: var(--accent);
        }

        .note.success {
            background: #dcfce7;
            border-color: #86efac;
        }
        .note.success strong {
            color: var(--green);
        }

        .difficulty-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
            margin: 1rem 0;
        }

        .difficulty-table th, .difficulty-table td {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border);
            text-align: left;
        }

        .difficulty-table th {
            background: var(--code-bg);
            font-weight: 600;
            font-size: 0.8rem;
            text-transform: uppercase;
        }

        .difficulty {
            display: inline-block;
            font-size: 0.75rem;
            font-weight: 600;
            padding: 0.2rem 0.5rem;
            border-radius: 3px;
        }

        .difficulty.easy { background: #dcfce7; color: var(--green); }
        .difficulty.medium { background: #fef3c7; color: var(--yellow); }
        .difficulty.hard { background: #fee2e2; color: var(--red); }
        .difficulty.very-hard { background: #fce7f3; color: #be185d; }

        footer {
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border);
            font-size: 0.85rem;
            color: var(--muted);
        }

        footer a {
            color: var(--accent);
            text-decoration: none;
        }

        @media (max-width: 768px) {
            .two-col {
                grid-template-columns: 1fr;
            }
            .stats-row {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Formalizing Riemann-Roch in Lean 4</h1>
            <p>
                A work-in-progress formalization of the Riemann-Roch theorem for algebraic curves.
                <a href="https://github.com/cguth7/roch-riemann">Source on GitHub</a>
            </p>
        </header>

        <!-- Target Theorem -->
        <section>
            <h2>Target Theorem</h2>
            <div class="theorem-box">
                <div class="label">Riemann-Roch</div>
                <div class="equation">
                    l(D) - l(K - D) = deg(D) + 1 - g
                </div>
                <div class="gloss">
                    For a divisor D on a smooth projective curve of genus g, with canonical divisor K
                </div>
            </div>
        </section>

        <!-- Stats -->
        <section>
            <div class="stats-row">
                <div class="stat">
                    <div class="stat-num">43</div>
                    <div class="stat-label">Cycles</div>
                </div>
                <div class="stat">
                    <div class="stat-num">7</div>
                    <div class="stat-label">Modules</div>
                </div>
                <div class="stat">
                    <div class="stat-num">180+</div>
                    <div class="stat-label">Lemmas Proved</div>
                </div>
                <div class="stat">
                    <div class="stat-num">~43</div>
                    <div class="stat-label">Sorries Left</div>
                </div>
            </div>
        </section>

        <!-- Codebase Structure -->
        <section>
            <h2>Codebase Structure (Modularized Cycle 40)</h2>
            <div class="two-col">
                <div class="approach-box">
                    <h4><span class="file">RrLean/RiemannRochV2/</span> Main Modules</h4>
                    <ul>
                        <li><code>Basic.lean</code> &mdash; Shared imports ✅</li>
                        <li><code>Divisor.lean</code> &mdash; DivisorV2 ✅</li>
                        <li><code>RRSpace.lean</code> &mdash; L(D), ℓ(D) ✅</li>
                        <li><code>Typeclasses.lean</code> &mdash; LocalGapBound ✅</li>
                        <li><code>RiemannInequality.lean</code> &mdash; Main theorems ✅</li>
                        <li><code>Infrastructure.lean</code> &mdash; Residue, uniformizer ✅</li>
                        <li><code>LocalGapInstance.lean</code> &mdash; ~1700 lines WIP</li>
                    </ul>
                </div>
                <div class="approach-box">
                    <h4><span class="file">archive/</span> Historical</h4>
                    <ul>
                        <li><code>RR_v1_axiom_based.lean</code> &mdash; Cycles 1-16</li>
                        <li><code>RR_v2_monolithic.lean</code> &mdash; Cycles 17-39</li>
                    </ul>
                    <p style="font-size: 0.85rem; color: var(--muted); margin-top: 1rem;">
                        <strong>Benefits:</strong> Faster iteration, parallel builds, clear separation of proven vs WIP code.
                    </p>
                </div>
            </div>
        </section>

        <!-- What We Have -->
        <section>
            <h2>What We Have (Proved)</h2>

            <div class="theorem-box green">
                <div class="label">Proved: Riemann Inequality (Cycle 21)</div>
                <div class="equation">
                    l(D) &le; deg(D) + 1
                </div>
                <div class="gloss">
                    For effective divisors D on a complete curve (uses SinglePointBound typeclass)
                </div>
            </div>

            <div class="theorem-box green">
                <div class="label">Proved: Affine Riemann Inequality (Cycle 23)</div>
                <div class="equation">
                    l(D) &le; deg(D) + l(0)
                </div>
                <div class="gloss">
                    For affine models where l(0) may be infinite (uses LocalGapBound + BaseDim)
                </div>
            </div>

            <h3 style="margin-top: 1.5rem;">Key Infrastructure</h3>
            <table class="status-table">
                <thead>
                    <tr>
                        <th>Component</th>
                        <th>Definition</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>localizationAtPrime_isDVR</code></td>
                        <td>Localization.AtPrime is DVR</td>
                        <td><span class="status done">Cycle 31</span></td>
                    </tr>
                    <tr>
                        <td><code>localization_isFractionRing</code></td>
                        <td>IsFractionRing (Loc.AtPrime) K</td>
                        <td><span class="status done">Cycle 35</span></td>
                    </tr>
                    <tr>
                        <td><code>range_algebraMap_subset_valuationRingAt</code></td>
                        <td>Forward set inclusion</td>
                        <td><span class="status done">Cycle 36</span></td>
                    </tr>
                    <tr>
                        <td><code>mem_of_algebraMap_mem_map</code></td>
                        <td>Ideal membership reverse direction</td>
                        <td><span class="status done">Cycle 41</span></td>
                    </tr>
                    <tr>
                        <td><code>algebraMap_isUnit_iff_not_mem</code></td>
                        <td>Unit characterization</td>
                        <td><span class="status done">Cycle 41</span></td>
                    </tr>
                    <tr>
                        <td><code>dvr_intValuation_of_isUnit</code></td>
                        <td>Units have intVal = 1</td>
                        <td><span class="status done">Cycle 41</span></td>
                    </tr>
                    <tr>
                        <td><code>mem_asIdeal_iff_mem_maxIdeal</code></td>
                        <td>r ∈ v.asIdeal ↔ algebraMap r ∈ maxIdeal</td>
                        <td><span class="status done">Cycle 43</span></td>
                    </tr>
                    <tr>
                        <td><code>dvr_intValuation_unit</code></td>
                        <td>r ∉ v.asIdeal ⟹ DVR.intVal = 1</td>
                        <td><span class="status done">Cycle 43</span></td>
                    </tr>
                    <tr>
                        <td><code>dvr_intValuation_of_algebraMap'</code> (easy)</td>
                        <td>DVR intVal = v.intVal for r ∉ v.asIdeal</td>
                        <td><span class="status done">Cycle 43</span></td>
                    </tr>
                    <tr>
                        <td><code>dvr_intValuation_of_algebraMap'</code> (hard)</td>
                        <td>DVR intVal = v.intVal for r ∈ v.asIdeal</td>
                        <td><span class="status wip">SORRY</span></td>
                    </tr>
                    <tr>
                        <td><code>dvr_valuation_eq_height_one'</code></td>
                        <td>DVR valuation = HeightOneSpectrum valuation</td>
                        <td><span class="status blocked">KEY BLOCKER</span></td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- Current Blocker -->
        <section>
            <h2>Current Status: Victory Path Clear</h2>

            <div class="note success">
                <strong>Cycle 43 Achievement:</strong> Section reordering complete! 3 lemmas proved:
                <code>mem_asIdeal_iff_mem_maxIdeal</code>, <code>dvr_intValuation_unit</code>,
                <code>dvr_intValuation_of_algebraMap'</code> (easy case). Foundation lemmas chain complete.
            </div>

            <h3>Blocking Chain</h3>
            <pre style="background: var(--code-bg); padding: 1rem; border-radius: 6px; overflow-x: auto; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">
dvr_intValuation_of_algebraMap' hard case (SORRY - r ∈ v.asIdeal)
    ↓
dvr_valuation_eq_height_one' (KEY BLOCKER)
    ↓
valuationRingAt_subset_range_algebraMap' (PROVED*, depends on above)
    ↓
valuationRingAt_equiv_localization → residueMapFromR_surjective
    ↓
evaluationMapAt → instLocalGapBound → VICTORY</pre>

            <h3 style="margin-top: 1.5rem;">Recent Progress (Cycles 41-43)</h3>
            <ul style="margin: 1rem 0; padding-left: 1.5rem;">
                <li><strong>Cycle 41:</strong> 8/8 foundation lemmas PROVED (ideal membership, unit characterization)</li>
                <li><strong>Cycle 42:</strong> Section ordering blocker identified</li>
                <li><strong>Cycle 43:</strong> Section reordering executed, 3 lemmas proved, sorry count 47→43</li>
            </ul>
        </section>

        <!-- Build Progress -->
        <section>
            <h2>Build Progress by Cycle</h2>
            <table class="status-table">
                <thead>
                    <tr>
                        <th>Cycle</th>
                        <th>Focus</th>
                        <th>Key Results</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>1-16</td>
                        <td>Axiom-based RR.lean</td>
                        <td>Full RR structure, genus formulas, Clifford</td>
                        <td><span class="status done">70+ proved</span></td>
                    </tr>
                    <tr>
                        <td>17-23</td>
                        <td>Constructive RR_v2.lean</td>
                        <td><code>RRModuleV2</code>, <code>riemann_inequality_real</code>, typeclasses</td>
                        <td><span class="status done">40+ proved</span></td>
                    </tr>
                    <tr>
                        <td>24-30</td>
                        <td>Valuation infrastructure</td>
                        <td>Uniformizer, valuation ring, residue map, kernel proofs</td>
                        <td><span class="status done">35+ proved</span></td>
                    </tr>
                    <tr>
                        <td>31-37</td>
                        <td>DVR & set equality</td>
                        <td>DVR instance, IsFractionRing, forward/converse set inclusion</td>
                        <td><span class="status done">30+ proved</span></td>
                    </tr>
                    <tr>
                        <td>38-39</td>
                        <td>intValuation bridge</td>
                        <td>Bridge candidates, foundation approach identified</td>
                        <td><span class="status wip">4 proved</span></td>
                    </tr>
                    <tr>
                        <td>40</td>
                        <td>Modularization</td>
                        <td>Split 2500-line file into 7 focused modules</td>
                        <td><span class="status done">Complete</span></td>
                    </tr>
                    <tr>
                        <td>41</td>
                        <td>Foundation lemmas</td>
                        <td>Ideal membership, unit characterization</td>
                        <td><span class="status done">8/8 proved</span></td>
                    </tr>
                    <tr>
                        <td>42</td>
                        <td>Section ordering</td>
                        <td>Identified blocker: Cycle 39 needed Cycle 41 lemmas</td>
                        <td><span class="status done">Diagnosed</span></td>
                    </tr>
                    <tr>
                        <td>43</td>
                        <td>Section reordering</td>
                        <td><code>mem_asIdeal_iff_mem_maxIdeal</code>, <code>dvr_intValuation_unit</code></td>
                        <td><span class="status done">3 proved</span></td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- What's Next -->
        <section>
            <h2>What's Next (Cycle 44)</h2>
            <h3>Immediate Goal</h3>
            <ul style="margin: 1rem 0; padding-left: 1.5rem;">
                <li><strong>Prove <code>dvr_intValuation_of_algebraMap'</code> hard case</strong> &mdash; When r ∈ v.asIdeal</li>
            </ul>

            <h3 style="margin-top: 1.5rem;">Approach</h3>
            <ul style="margin: 1rem 0; padding-left: 1.5rem;">
                <li>Use <code>mem_asIdeal_pow_iff_mem_maxIdeal_pow</code> for induction on ideal powers</li>
                <li>Or: Use uniformizer factorization (both intValuations measure powers of same prime)</li>
                <li>Once hard case done → <code>dvr_valuation_eq_height_one'</code> follows → cascade to victory</li>
            </ul>

            <h3 style="margin-top: 1.5rem;">Stretch Goals</h3>
            <ul style="margin: 1rem 0; padding-left: 1.5rem;">
                <li><strong>Compactification</strong> &mdash; Add infinite places to get l(0) = 1</li>
                <li><strong>Serre duality</strong> &mdash; Would require differentials, residue map, residue theorem</li>
            </ul>
        </section>

        <!-- Meta: Process -->
        <section>
            <h2>Meta: How This Project Evolved</h2>

            <p style="margin-bottom: 1.5rem;">
                This project uses an <strong>ACE-style orchestration loop</strong>: an LLM (Claude) guided by
                a human through iterative "cycles" of planning, implementation, and review. Each cycle
                targets a specific edge of the proof graph, builds it, tests it, and commits.
            </p>

            <h3>Key Pivots</h3>
            <table class="status-table">
                <thead>
                    <tr>
                        <th>Cycle</th>
                        <th>Discovery</th>
                        <th>Response</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>17</td>
                        <td>Axiom approach hit ceiling</td>
                        <td>Created RR_v2.lean with Dedekind domain foundations</td>
                    </tr>
                    <tr>
                        <td>22</td>
                        <td>HeightOneSpectrum = finite places only</td>
                        <td>Split into LocalGapBound (affine) + SinglePointBound (projective)</td>
                    </tr>
                    <tr>
                        <td>31</td>
                        <td>Need DVR structure on localization</td>
                        <td>Proved Localization.AtPrime is DVR</td>
                    </tr>
                    <tr>
                        <td>37</td>
                        <td>Found mathlib's <code>exists_lift_of_le_one</code></td>
                        <td>Complete proof structure via DVR valuation comparison</td>
                    </tr>
                    <tr>
                        <td>40</td>
                        <td>2500-line file too large</td>
                        <td>Modularized into 7 focused modules</td>
                    </tr>
                    <tr>
                        <td>41</td>
                        <td>Foundation lemmas approach</td>
                        <td>Decomposed valuation equality into ideal membership + unit case</td>
                    </tr>
                    <tr>
                        <td>43</td>
                        <td>Section ordering bug</td>
                        <td>Reordered sections, proved 3 blocked lemmas</td>
                    </tr>
                </tbody>
            </table>

            <h3 style="margin-top: 1.5rem;">Honest Assessment</h3>
            <p style="margin-bottom: 1rem;">
                <strong>What we achieved:</strong> A working proof of the Riemann inequality from Dedekind domain
                foundations, plus a complete axiom-based development of RR consequences. The core algebraic machinery
                is solid, and we're one lemma away from completing the LocalGapBound instance.
            </p>
            <p style="margin-bottom: 1rem;">
                <strong>What's missing for "real" RR:</strong> The l(K-D) term requires Serre duality, which requires
                differentials, residues, and the residue theorem. This is substantial algebraic geometry that
                mathlib doesn't have.
            </p>
            <p style="color: var(--muted);">
                <strong>Bottom line:</strong> This is an honest partial formalization. We proved the "easy half"
                (Riemann inequality) constructively and axiomatized the "hard half" (duality). The axiom-based
                results are mathematically valid conditional on RR holding; the constructive results are unconditional.
            </p>
        </section>

        <footer>
            <p>
                Lean 4 + mathlib &bull;
                <a href="https://github.com/cguth7/roch-riemann">GitHub</a> &bull;
                Cycle 43 &bull;
                Last updated: Dec 17, 2024
            </p>
        </footer>
    </div>
</body>
</html>
