<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Riemann-Roch Formalization</title>
    <link href="https://fonts.googleapis.com/css2?family=CMU+Serif:wght@400;700&family=JetBrains+Mono:wght@400;600&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #fafafa;
            --text: #1a1a1a;
            --muted: #666;
            --border: #ddd;
            --accent: #2563eb;
            --green: #16a34a;
            --yellow: #ca8a04;
            --red: #dc2626;
            --code-bg: #f3f4f6;
            --math-bg: #f8fafc;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            font-size: 16px;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 3rem 2rem;
        }

        header {
            margin-bottom: 3rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid var(--border);
        }

        header h1 {
            font-size: 1.75rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        header p {
            color: var(--muted);
            font-size: 0.95rem;
        }

        header a {
            color: var(--accent);
            text-decoration: none;
        }

        section {
            margin-bottom: 3rem;
        }

        h2 {
            font-size: 1.1rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--muted);
            margin-bottom: 1.5rem;
        }

        h3 {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
        }

        .theorem-box {
            background: var(--math-bg);
            border: 1px solid var(--border);
            border-left: 3px solid var(--accent);
            padding: 1.5rem 2rem;
            margin-bottom: 2rem;
        }

        .theorem-box .label {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--accent);
            margin-bottom: 0.75rem;
        }

        .theorem-box .equation {
            font-family: 'Times New Roman', Georgia, serif;
            font-size: 1.5rem;
            font-style: italic;
            text-align: center;
            padding: 1rem 0;
        }

        .theorem-box .gloss {
            font-size: 0.9rem;
            color: var(--muted);
            text-align: center;
        }

        .theorem-box.green {
            border-left-color: var(--green);
        }
        .theorem-box.green .label {
            color: var(--green);
        }

        .two-col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .approach-box {
            padding: 1.5rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: white;
        }

        .approach-box h4 {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .approach-box .file {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            background: var(--code-bg);
            padding: 0.2rem 0.5rem;
            border-radius: 3px;
        }

        .approach-box ul {
            font-size: 0.9rem;
            margin-left: 1.25rem;
            margin-bottom: 0.75rem;
        }

        .approach-box li {
            margin-bottom: 0.25rem;
        }

        .approach-box code {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            background: var(--code-bg);
            padding: 0.1rem 0.3rem;
            border-radius: 3px;
        }

        .stats-row {
            display: flex;
            gap: 2rem;
            padding: 1.5rem 0;
            border-top: 1px solid var(--border);
            border-bottom: 1px solid var(--border);
            margin-bottom: 2rem;
        }

        .stat {
            text-align: center;
        }

        .stat-num {
            font-size: 2rem;
            font-weight: 600;
            color: var(--text);
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .status-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .status-table th {
            text-align: left;
            padding: 0.75rem 1rem;
            background: var(--code-bg);
            border-bottom: 1px solid var(--border);
            font-weight: 600;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .status-table td {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border);
            vertical-align: top;
        }

        .status-table code {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            background: var(--code-bg);
            padding: 0.1rem 0.4rem;
            border-radius: 3px;
        }

        .status {
            display: inline-block;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            padding: 0.2rem 0.5rem;
            border-radius: 3px;
        }

        .status.done { background: #dcfce7; color: var(--green); }
        .status.wip { background: #fef3c7; color: var(--yellow); }
        .status.blocked { background: #fee2e2; color: var(--red); }

        .note {
            background: #fffbeb;
            border: 1px solid #fcd34d;
            border-radius: 6px;
            padding: 1rem 1.25rem;
            font-size: 0.9rem;
            margin: 1rem 0;
        }

        .note strong {
            color: var(--yellow);
        }

        .note.info {
            background: #eff6ff;
            border-color: #93c5fd;
        }
        .note.info strong {
            color: var(--accent);
        }

        .note.success {
            background: #dcfce7;
            border-color: #86efac;
        }
        .note.success strong {
            color: var(--green);
        }

        .difficulty-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
            margin: 1rem 0;
        }

        .difficulty-table th, .difficulty-table td {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border);
            text-align: left;
        }

        .difficulty-table th {
            background: var(--code-bg);
            font-weight: 600;
            font-size: 0.8rem;
            text-transform: uppercase;
        }

        .difficulty {
            display: inline-block;
            font-size: 0.75rem;
            font-weight: 600;
            padding: 0.2rem 0.5rem;
            border-radius: 3px;
        }

        .difficulty.easy { background: #dcfce7; color: var(--green); }
        .difficulty.medium { background: #fef3c7; color: var(--yellow); }
        .difficulty.hard { background: #fee2e2; color: var(--red); }
        .difficulty.very-hard { background: #fce7f3; color: #be185d; }

        footer {
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border);
            font-size: 0.85rem;
            color: var(--muted);
        }

        footer a {
            color: var(--accent);
            text-decoration: none;
        }

        @media (max-width: 768px) {
            .two-col {
                grid-template-columns: 1fr;
            }
            .stats-row {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Formalizing Riemann-Roch in Lean 4</h1>
            <p>
                A work-in-progress formalization of the Riemann-Roch theorem for algebraic curves.
                <a href="https://github.com/cguth7/roch-riemann">Source on GitHub</a>
            </p>
        </header>

        <!-- Target Theorem -->
        <section>
            <h2>Target Theorem</h2>
            <div class="theorem-box">
                <div class="label">Riemann-Roch</div>
                <div class="equation">
                    l(D) - l(K - D) = deg(D) + 1 - g
                </div>
                <div class="gloss">
                    For a divisor D on a smooth projective curve of genus g, with canonical divisor K
                </div>
            </div>
        </section>

        <!-- Stats -->
        <section>
            <div class="stats-row">
                <div class="stat">
                    <div class="stat-num">37</div>
                    <div class="stat-label">Cycles</div>
                </div>
                <div class="stat">
                    <div class="stat-num">2</div>
                    <div class="stat-label">Approaches</div>
                </div>
                <div class="stat">
                    <div class="stat-num">150+</div>
                    <div class="stat-label">Lemmas Proved</div>
                </div>
                <div class="stat">
                    <div class="stat-num">1</div>
                    <div class="stat-label">Key Blocker</div>
                </div>
            </div>
        </section>

        <!-- Two Approaches -->
        <section>
            <h2>Two Parallel Approaches</h2>
            <div class="two-col">
                <div class="approach-box">
                    <h4><span class="file">RR.lean</span> Axiom-Based (Archived)</h4>
                    <ul>
                        <li>Abstract <code>FunctionFieldData</code> structure</li>
                        <li>Axiomatizes single-point bound, RR equation</li>
                        <li>Derives genus 0, genus 1, high-degree formulas</li>
                        <li>Clifford's theorem (with multiplication axiom)</li>
                    </ul>
                    <p style="font-size: 0.85rem; color: var(--muted);">
                        <strong>Philosophy:</strong> Capture logical structure of RR, defer construction.
                    </p>
                </div>
                <div class="approach-box" style="border-color: var(--green);">
                    <h4><span class="file">RR_v2.lean</span> Constructive (Dedekind Domains)</h4>
                    <ul>
                        <li>Points = <code>HeightOneSpectrum R</code> (height-1 primes)</li>
                        <li>L(D) defined via valuations at each prime</li>
                        <li>Dimension = <code>Module.length</code> (additive in exact sequences)</li>
                        <li><strong>Riemann inequality PROVED</strong> by degree induction</li>
                    </ul>
                    <p style="font-size: 0.85rem; color: var(--green);">
                        <strong>Status:</strong> Core infrastructure complete. DVR-based set equality nearly complete (1 blocker).
                    </p>
                </div>
            </div>
        </section>

        <!-- What We Have -->
        <section>
            <h2>What We Have (Proved)</h2>

            <div class="theorem-box green">
                <div class="label">Proved: Riemann Inequality (Cycle 21)</div>
                <div class="equation">
                    l(D) &le; deg(D) + 1
                </div>
                <div class="gloss">
                    For effective divisors D on a complete curve (uses SinglePointBound typeclass)
                </div>
            </div>

            <div class="theorem-box green">
                <div class="label">Proved: Affine Riemann Inequality (Cycle 23)</div>
                <div class="equation">
                    l(D) &le; deg(D) + l(0)
                </div>
                <div class="gloss">
                    For affine models where l(0) may be infinite (uses LocalGapBound + BaseDim)
                </div>
            </div>

            <h3 style="margin-top: 1.5rem;">Key Infrastructure (RR_v2.lean)</h3>
            <table class="status-table">
                <thead>
                    <tr>
                        <th>Component</th>
                        <th>Definition</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>DivisorV2</code></td>
                        <td><code>HeightOneSpectrum R ->0 Z</code></td>
                        <td><span class="status done">Proved</span></td>
                    </tr>
                    <tr>
                        <td><code>RRModuleV2_real</code></td>
                        <td>L(D) via valuation conditions</td>
                        <td><span class="status done">Proved</span></td>
                    </tr>
                    <tr>
                        <td><code>ellV2_real_mono</code></td>
                        <td>D &le; E implies l(D) &le; l(E)</td>
                        <td><span class="status done">Proved</span></td>
                    </tr>
                    <tr>
                        <td><code>localizationAtPrime_isDVR</code></td>
                        <td>Localization.AtPrime is DVR</td>
                        <td><span class="status done">Proved (Cycle 31)</span></td>
                    </tr>
                    <tr>
                        <td><code>localization_isFractionRing</code></td>
                        <td>IsFractionRing (Loc.AtPrime) K</td>
                        <td><span class="status done">Proved (Cycle 35)</span></td>
                    </tr>
                    <tr>
                        <td><code>mk_mem_valuationRingAt</code></td>
                        <td>Forward: fractions have v &le; 1</td>
                        <td><span class="status done">Proved (Cycle 33)</span></td>
                    </tr>
                    <tr>
                        <td><code>range_algebraMap_subset_valuationRingAt</code></td>
                        <td>Forward set inclusion</td>
                        <td><span class="status done">Proved (Cycle 36)</span></td>
                    </tr>
                    <tr>
                        <td><code>dvr_valuationSubring_eq_range</code></td>
                        <td>DVR range = valuationSubring</td>
                        <td><span class="status done">Proved (Cycle 37)</span></td>
                    </tr>
                    <tr>
                        <td><code>valuationRingAt_subset_range_algebraMap'</code></td>
                        <td>Converse set inclusion</td>
                        <td><span class="status wip">Proved* (needs blocker)</span></td>
                    </tr>
                    <tr>
                        <td><code>riemann_inequality_real</code></td>
                        <td>l(D) &le; deg(D) + 1</td>
                        <td><span class="status done">Proved</span></td>
                    </tr>
                </tbody>
            </table>

            <h3 style="margin-top: 1.5rem;">Derived Results (RR.lean)</h3>
            <ul style="margin: 1rem 0; padding-left: 1.5rem;">
                <li><code>ell_K = g</code> &mdash; Canonical space dimension equals genus</li>
                <li><code>ell_K_sub_D_eq_zero_of_deg_gt</code> &mdash; Vanishing theorem</li>
                <li><code>ell_eq_deg_succ_of_genus_zero_deg_gt</code> &mdash; Genus 0: l(D) = deg + 1</li>
                <li><code>ell_eq_deg_of_genus_one_deg_pos</code> &mdash; Genus 1: l(D) = deg</li>
                <li><code>clifford_bound'</code> &mdash; Clifford's inequality (with mul axiom)</li>
            </ul>
        </section>

        <!-- Current Blocker -->
        <section>
            <h2>Current Status: Single Key Blocker</h2>

            <div class="note info">
                <strong>Cycle 37 Achievement:</strong> Complete proof structure! 7/8 candidates compile.
                The full set equality <code>valuationRingAt = range(algebraMap from Loc.AtPrime)</code>
                is now structurally complete, pending one valuation comparison lemma.
            </div>

            <h3>The Blocker: <code>dvr_valuation_eq_height_one'</code></h3>
            <p style="margin: 1rem 0;">Need to prove that two valuations agree on K:</p>
            <pre style="background: var(--code-bg); padding: 1rem; border-radius: 6px; overflow-x: auto; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">
(IsDiscreteValuationRing.maximalIdeal (Localization.AtPrime v.asIdeal)).valuation K g
  = v.valuation K g</pre>

            <p style="margin: 1rem 0; color: var(--muted);">
                <strong>Why this should work:</strong> Both valuations are defined from the same prime ideal <code>v.asIdeal</code>.
                The DVR's maximalIdeal equals <code>Ideal.map v.asIdeal</code>. Both extend <code>intValuation</code> to K.
            </p>

            <h3 style="margin-top: 1.5rem;">Cascade Once Resolved</h3>
            <p style="margin: 0.5rem 0;">When <code>dvr_valuation_eq_height_one'</code> is proved, these automatically complete:</p>
            <ul style="margin: 1rem 0; padding-left: 1.5rem;">
                <li><code>valuationRingAt_subset_range_algebraMap'</code> &mdash; Converse direction</li>
                <li><code>valuationSubring_eq_localization_image_complete</code> &mdash; Full set equality</li>
                <li><code>exists_coprime_rep</code> &mdash; Coprime representation</li>
                <li><code>valuationRingAt_equiv_localization</code> &mdash; DVR equivalence</li>
                <li><code>residueMapFromR_surjective</code> &mdash; Residue map surjectivity</li>
                <li><code>evaluationMapAt</code> &mdash; Evaluation map construction</li>
                <li><code>instLocalGapBound</code> &mdash; <strong>VICTORY</strong></li>
            </ul>
        </section>

        <!-- Build Progress -->
        <section>
            <h2>Build Progress by Cycle</h2>
            <table class="status-table">
                <thead>
                    <tr>
                        <th>Cycle</th>
                        <th>Focus</th>
                        <th>Key Results</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>1-16</td>
                        <td>Axiom-based RR.lean</td>
                        <td>Full RR structure, genus formulas, Clifford</td>
                        <td><span class="status done">70+ proved</span></td>
                    </tr>
                    <tr>
                        <td>17-21</td>
                        <td>Constructive RR_v2.lean</td>
                        <td><code>RRModuleV2</code>, <code>riemann_inequality_real</code></td>
                        <td><span class="status done">30+ proved</span></td>
                    </tr>
                    <tr>
                        <td>22-23</td>
                        <td>Typeclass hierarchy</td>
                        <td><code>LocalGapBound</code> / <code>SinglePointBound</code></td>
                        <td><span class="status done">11 proved</span></td>
                    </tr>
                    <tr>
                        <td>24-28</td>
                        <td>Valuation infrastructure</td>
                        <td>Uniformizer, valuation ring, residue map</td>
                        <td><span class="status done">25+ proved</span></td>
                    </tr>
                    <tr>
                        <td>29-30</td>
                        <td>Kernel proofs</td>
                        <td><code>shifted_element_valuation_le_one</code>, <code>residueMapFromR_ker</code></td>
                        <td><span class="status done">10 proved</span></td>
                    </tr>
                    <tr>
                        <td>31-33</td>
                        <td>DVR & localization</td>
                        <td><code>localizationAtPrime_isDVR</code>, <code>mk_mem_valuationRingAt</code></td>
                        <td><span class="status done">12 proved</span></td>
                    </tr>
                    <tr>
                        <td>34</td>
                        <td>Arithmetic lemmas</td>
                        <td><code>valuation_of_fraction</code>, partial <code>exists_coprime_rep</code></td>
                        <td><span class="status done">4 proved</span></td>
                    </tr>
                    <tr>
                        <td>35</td>
                        <td>IsFractionRing instance</td>
                        <td><code>localization_isFractionRing</code>, scalar tower</td>
                        <td><span class="status done">7 proved</span></td>
                    </tr>
                    <tr>
                        <td>36</td>
                        <td>Forward set inclusion</td>
                        <td><code>range_algebraMap_subset_valuationRingAt</code></td>
                        <td><span class="status done">5 proved</span></td>
                    </tr>
                    <tr>
                        <td>37</td>
                        <td>Complete proof structure</td>
                        <td><code>dvr_valuationSubring_eq_range</code>, converse (conditional)</td>
                        <td><span class="status wip">7/8 compile</span></td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- What's Next -->
        <section>
            <h2>What's Next (Cycle 38)</h2>
            <h3>Immediate Goal</h3>
            <ul style="margin: 1rem 0; padding-left: 1.5rem;">
                <li><strong>Prove <code>dvr_valuation_eq_height_one'</code></strong> &mdash; Show DVR valuation equals HeightOneSpectrum valuation</li>
            </ul>
            <p style="color: var(--muted); margin: 1rem 0;">
                Once this single lemma is proved, 7+ dependent lemmas automatically complete, and we get <code>LocalGapBound</code> instance.
            </p>

            <h3 style="margin-top: 1.5rem;">Approach</h3>
            <ul style="margin: 1rem 0; padding-left: 1.5rem;">
                <li>Study how <code>HeightOneSpectrum.valuation</code> is defined (via <code>intValuation.extendToLocalization</code>)</li>
                <li>Study how <code>IsDiscreteValuationRing.maximalIdeal.valuation</code> is defined</li>
                <li>Show both valuations extend from the same <code>intValuation</code> on R</li>
                <li>Use function extensionality to prove equality on K</li>
            </ul>

            <h3 style="margin-top: 1.5rem;">Stretch Goals</h3>
            <ul style="margin: 1rem 0; padding-left: 1.5rem;">
                <li><strong>Compactification</strong> &mdash; Add infinite places to get l(0) = 1</li>
                <li><strong>Serre duality</strong> &mdash; Would require differentials, residue map, residue theorem</li>
                <li><strong>Full constructive RR</strong> &mdash; Remove all axioms from RR.lean by instantiation</li>
            </ul>
        </section>

        <!-- Meta: Process -->
        <section>
            <h2>Meta: How This Project Evolved</h2>

            <p style="margin-bottom: 1.5rem;">
                This project used an <strong>ACE-style orchestration loop</strong>: an LLM (Claude) guided by
                a human through iterative "cycles" of planning, implementation, and review. Each cycle
                targets a specific edge of the proof graph, builds it, tests it, and commits.
            </p>

            <h3>Key Pivots</h3>
            <table class="status-table">
                <thead>
                    <tr>
                        <th>Cycle</th>
                        <th>Discovery</th>
                        <th>Response</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>17</td>
                        <td>Axiom approach hit ceiling; couldn't instantiate</td>
                        <td>Created RR_v2.lean with Dedekind domain foundations</td>
                    </tr>
                    <tr>
                        <td>20</td>
                        <td>finrank not monotonic for infinite-dimensional quotients</td>
                        <td>Switched to Module.length (ENat-valued, additive)</td>
                    </tr>
                    <tr>
                        <td>22</td>
                        <td>HeightOneSpectrum = finite places only</td>
                        <td>Split into LocalGapBound (affine) + SinglePointBound (projective)</td>
                    </tr>
                    <tr>
                        <td>31</td>
                        <td>Need DVR structure on localization</td>
                        <td>Proved Localization.AtPrime is DVR; pivoted to DVR-based approach</td>
                    </tr>
                    <tr>
                        <td>35</td>
                        <td>Need IsFractionRing instance</td>
                        <td>Built instance chain: primeCompl_isUnit → localizationToK → algebra → IsFractionRing</td>
                    </tr>
                    <tr>
                        <td>37</td>
                        <td>Found mathlib's <code>exists_lift_of_le_one</code></td>
                        <td>Complete proof structure via DVR valuation comparison</td>
                    </tr>
                </tbody>
            </table>

            <h3 style="margin-top: 1.5rem;">Honest Assessment</h3>
            <p style="margin-bottom: 1rem;">
                <strong>What we achieved:</strong> A working proof of the Riemann inequality from Dedekind domain
                foundations, plus a complete axiom-based development of RR consequences. The core algebraic machinery
                is solid, and we're one lemma away from completing the LocalGapBound instance.
            </p>
            <p style="margin-bottom: 1rem;">
                <strong>What's missing for "real" RR:</strong> The l(K-D) term requires Serre duality, which requires
                differentials, residues, and the residue theorem. This is substantial algebraic geometry that
                mathlib doesn't have.
            </p>
            <p style="color: var(--muted);">
                <strong>Bottom line:</strong> This is an honest partial formalization. We proved the "easy half"
                (Riemann inequality) constructively and axiomatized the "hard half" (duality). The axiom-based
                results are mathematically valid conditional on RR holding; the constructive results are unconditional.
            </p>
        </section>

        <footer>
            <p>
                Lean 4 + mathlib &bull;
                <a href="https://github.com/cguth7/roch-riemann">GitHub</a> &bull;
                Cycle 37 &bull;
                Last updated: Dec 16, 2024
            </p>
        </footer>
    </div>
</body>
</html>
