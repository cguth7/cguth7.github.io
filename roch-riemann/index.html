<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Riemann-Roch Formalization</title>
    <link href="https://fonts.googleapis.com/css2?family=CMU+Serif:wght@400;700&family=JetBrains+Mono:wght@400;600&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #fafafa;
            --text: #1a1a1a;
            --muted: #666;
            --border: #ddd;
            --accent: #2563eb;
            --green: #16a34a;
            --yellow: #ca8a04;
            --red: #dc2626;
            --code-bg: #f3f4f6;
            --math-bg: #f8fafc;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            font-size: 16px;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 3rem 2rem;
        }

        header {
            margin-bottom: 3rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid var(--border);
        }

        header h1 {
            font-size: 1.75rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        header p {
            color: var(--muted);
            font-size: 0.95rem;
        }

        header a {
            color: var(--accent);
            text-decoration: none;
        }

        section {
            margin-bottom: 3rem;
        }

        h2 {
            font-size: 1.1rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--muted);
            margin-bottom: 1.5rem;
        }

        h3 {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
        }

        .theorem-box {
            background: var(--math-bg);
            border: 1px solid var(--border);
            border-left: 3px solid var(--accent);
            padding: 1.5rem 2rem;
            margin-bottom: 2rem;
        }

        .theorem-box .label {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--accent);
            margin-bottom: 0.75rem;
        }

        .theorem-box .equation {
            font-family: 'Times New Roman', Georgia, serif;
            font-size: 1.5rem;
            font-style: italic;
            text-align: center;
            padding: 1rem 0;
        }

        .theorem-box .gloss {
            font-size: 0.9rem;
            color: var(--muted);
            text-align: center;
        }

        .theorem-box.green {
            border-left-color: var(--green);
        }
        .theorem-box.green .label {
            color: var(--green);
        }

        .two-col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .approach-box {
            padding: 1.5rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: white;
        }

        .approach-box h4 {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .approach-box .file {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            background: var(--code-bg);
            padding: 0.2rem 0.5rem;
            border-radius: 3px;
        }

        .approach-box ul {
            font-size: 0.9rem;
            margin-left: 1.25rem;
            margin-bottom: 0.75rem;
        }

        .approach-box li {
            margin-bottom: 0.25rem;
        }

        .approach-box code {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            background: var(--code-bg);
            padding: 0.1rem 0.3rem;
            border-radius: 3px;
        }

        .stats-row {
            display: flex;
            gap: 2rem;
            padding: 1.5rem 0;
            border-top: 1px solid var(--border);
            border-bottom: 1px solid var(--border);
            margin-bottom: 2rem;
        }

        .stat {
            text-align: center;
        }

        .stat-num {
            font-size: 2rem;
            font-weight: 600;
            color: var(--text);
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .status-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .status-table th {
            text-align: left;
            padding: 0.75rem 1rem;
            background: var(--code-bg);
            border-bottom: 1px solid var(--border);
            font-weight: 600;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .status-table td {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border);
            vertical-align: top;
        }

        .status-table code {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            background: var(--code-bg);
            padding: 0.1rem 0.4rem;
            border-radius: 3px;
        }

        .status {
            display: inline-block;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            padding: 0.2rem 0.5rem;
            border-radius: 3px;
        }

        .status.done { background: #dcfce7; color: var(--green); }
        .status.wip { background: #fef3c7; color: var(--yellow); }
        .status.blocked { background: #fee2e2; color: var(--red); }

        .note {
            background: #fffbeb;
            border: 1px solid #fcd34d;
            border-radius: 6px;
            padding: 1rem 1.25rem;
            font-size: 0.9rem;
            margin: 1rem 0;
        }

        .note strong {
            color: var(--yellow);
        }

        .note.info {
            background: #eff6ff;
            border-color: #93c5fd;
        }
        .note.info strong {
            color: var(--accent);
        }

        .note.success {
            background: #dcfce7;
            border-color: #86efac;
        }
        .note.success strong {
            color: var(--green);
        }

        .difficulty-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
            margin: 1rem 0;
        }

        .difficulty-table th, .difficulty-table td {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border);
            text-align: left;
        }

        .difficulty-table th {
            background: var(--code-bg);
            font-weight: 600;
            font-size: 0.8rem;
            text-transform: uppercase;
        }

        .difficulty {
            display: inline-block;
            font-size: 0.75rem;
            font-weight: 600;
            padding: 0.2rem 0.5rem;
            border-radius: 3px;
        }

        .difficulty.easy { background: #dcfce7; color: var(--green); }
        .difficulty.medium { background: #fef3c7; color: var(--yellow); }
        .difficulty.hard { background: #fee2e2; color: var(--red); }
        .difficulty.very-hard { background: #fce7f3; color: #be185d; }

        footer {
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border);
            font-size: 0.85rem;
            color: var(--muted);
        }

        footer a {
            color: var(--accent);
            text-decoration: none;
        }

        @media (max-width: 768px) {
            .two-col {
                grid-template-columns: 1fr;
            }
            .stats-row {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Formalizing Riemann-Roch in Lean 4</h1>
            <p>
                A work-in-progress formalization of the Riemann-Roch theorem for algebraic curves.
                <a href="https://github.com/cguth7/roch-riemann">Source on GitHub</a>
            </p>
        </header>

        <!-- Target Theorem -->
        <section>
            <h2>Target Theorem</h2>
            <div class="theorem-box">
                <div class="label">Riemann-Roch</div>
                <div class="equation">
                    l(D) - l(K - D) = deg(D) + 1 - g
                </div>
                <div class="gloss">
                    For a divisor D on a smooth projective curve of genus g, with canonical divisor K
                </div>
            </div>
        </section>

        <!-- Stats -->
        <section>
            <div class="stats-row">
                <div class="stat">
                    <div class="stat-num">27</div>
                    <div class="stat-label">Cycles</div>
                </div>
                <div class="stat">
                    <div class="stat-num">2</div>
                    <div class="stat-label">Approaches</div>
                </div>
                <div class="stat">
                    <div class="stat-num">100+</div>
                    <div class="stat-label">Lemmas Proved</div>
                </div>
                <div class="stat">
                    <div class="stat-num">7</div>
                    <div class="stat-label">Active Sorries</div>
                </div>
            </div>
        </section>

        <!-- Two Approaches -->
        <section>
            <h2>Two Parallel Approaches</h2>
            <div class="two-col">
                <div class="approach-box">
                    <h4><span class="file">RR.lean</span> Axiom-Based (Archived)</h4>
                    <ul>
                        <li>Abstract <code>FunctionFieldData</code> structure</li>
                        <li>Axiomatizes single-point bound, RR equation</li>
                        <li>Derives genus 0, genus 1, high-degree formulas</li>
                        <li>Clifford's theorem (with multiplication axiom)</li>
                    </ul>
                    <p style="font-size: 0.85rem; color: var(--muted);">
                        <strong>Philosophy:</strong> Capture logical structure of RR, defer construction.
                    </p>
                </div>
                <div class="approach-box" style="border-color: var(--green);">
                    <h4><span class="file">RR_v2.lean</span> Constructive (Dedekind Domains)</h4>
                    <ul>
                        <li>Points = <code>HeightOneSpectrum R</code> (height-1 primes)</li>
                        <li>L(D) defined via valuations at each prime</li>
                        <li>Dimension = <code>Module.length</code> (additive in exact sequences)</li>
                        <li><strong>Riemann inequality PROVED</strong> by degree induction</li>
                    </ul>
                    <p style="font-size: 0.85rem; color: var(--green);">
                        <strong>Status:</strong> Core infrastructure complete, working toward unconditional LocalGapBound.
                    </p>
                </div>
            </div>
        </section>

        <!-- What We Have -->
        <section>
            <h2>What We Have (Proved)</h2>

            <div class="theorem-box green">
                <div class="label">Proved: Riemann Inequality (Cycle 21)</div>
                <div class="equation">
                    l(D) &le; deg(D) + 1
                </div>
                <div class="gloss">
                    For effective divisors D on a complete curve (uses SinglePointBound typeclass)
                </div>
            </div>

            <div class="theorem-box green">
                <div class="label">Proved: Affine Riemann Inequality (Cycle 23)</div>
                <div class="equation">
                    l(D) &le; deg(D) + l(0)
                </div>
                <div class="gloss">
                    For affine models where l(0) may be infinite (uses LocalGapBound + BaseDim)
                </div>
            </div>

            <h3 style="margin-top: 1.5rem;">Key Infrastructure (RR_v2.lean)</h3>
            <table class="status-table">
                <thead>
                    <tr>
                        <th>Component</th>
                        <th>Definition</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>DivisorV2</code></td>
                        <td><code>HeightOneSpectrum R ->0 Z</code></td>
                        <td><span class="status done">Proved</span></td>
                    </tr>
                    <tr>
                        <td><code>RRModuleV2_real</code></td>
                        <td>L(D) via valuation conditions</td>
                        <td><span class="status done">Proved</span></td>
                    </tr>
                    <tr>
                        <td><code>ellV2_real_mono</code></td>
                        <td>D &le; E implies l(D) &le; l(E)</td>
                        <td><span class="status done">Proved</span></td>
                    </tr>
                    <tr>
                        <td><code>residueFieldAtPrime.linearEquiv</code></td>
                        <td>R/v.asIdeal &cong; kappa(v)</td>
                        <td><span class="status done">Proved</span></td>
                    </tr>
                    <tr>
                        <td><code>residueFieldAtPrime.isSimpleModule</code></td>
                        <td>kappa(v) is simple R-module</td>
                        <td><span class="status done">Proved</span></td>
                    </tr>
                    <tr>
                        <td><code>local_gap_bound_of_exists_map</code></td>
                        <td>Linear algebra bridge lemma</td>
                        <td><span class="status done">Proved</span></td>
                    </tr>
                    <tr>
                        <td><code>uniformizerAt</code></td>
                        <td>Uniformizer pi at height-1 prime v</td>
                        <td><span class="status done">Proved</span></td>
                    </tr>
                    <tr>
                        <td><code>valuationRingAt</code></td>
                        <td>Valuation ring at v (local ring)</td>
                        <td><span class="status done">Proved</span></td>
                    </tr>
                    <tr>
                        <td><code>partialResidueMap</code></td>
                        <td>K-element (v(g) &le; 1) to residue field</td>
                        <td><span class="status done">Defined</span></td>
                    </tr>
                    <tr>
                        <td><code>riemann_inequality_real</code></td>
                        <td>l(D) &le; deg(D) + 1</td>
                        <td><span class="status done">Proved</span></td>
                    </tr>
                </tbody>
            </table>

            <h3 style="margin-top: 1.5rem;">Derived Results (RR.lean)</h3>
            <ul style="margin: 1rem 0; padding-left: 1.5rem;">
                <li><code>ell_K = g</code> &mdash; Canonical space dimension equals genus</li>
                <li><code>ell_K_sub_D_eq_zero_of_deg_gt</code> &mdash; Vanishing theorem</li>
                <li><code>ell_eq_deg_succ_of_genus_zero_deg_gt</code> &mdash; Genus 0: l(D) = deg + 1</li>
                <li><code>ell_eq_deg_of_genus_one_deg_pos</code> &mdash; Genus 1: l(D) = deg</li>
                <li><code>clifford_bound'</code> &mdash; Clifford's inequality (with mul axiom)</li>
            </ul>
        </section>

        <!-- Current Sorry Status -->
        <section>
            <h2>Current Sorry Status (RR_v2.lean)</h2>
            <table class="status-table">
                <thead>
                    <tr>
                        <th>Line</th>
                        <th>Name</th>
                        <th>Status</th>
                        <th>Notes</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>337</td>
                        <td><code>ellV2_mono</code></td>
                        <td><span class="status wip">Deprecated</span></td>
                        <td>Superseded by <code>ellV2_real_mono</code></td>
                    </tr>
                    <tr>
                        <td>715</td>
                        <td><code>riemann_inequality</code></td>
                        <td><span class="status wip">Deprecated</span></td>
                        <td>Superseded by <code>riemann_inequality_real</code></td>
                    </tr>
                    <tr>
                        <td>989</td>
                        <td><code>shifted_element_valuation_le_one</code></td>
                        <td><span class="status wip">Active</span></td>
                        <td>WithZero.exp arithmetic (proof path clear)</td>
                    </tr>
                    <tr>
                        <td>1029</td>
                        <td><code>evaluationMapAt</code></td>
                        <td><span class="status blocked">Blocker</span></td>
                        <td>Needs residue field bridge</td>
                    </tr>
                    <tr>
                        <td>1040</td>
                        <td><code>kernel_evaluationMapAt</code></td>
                        <td><span class="status blocked">Blocked</span></td>
                        <td>Depends on evaluationMapAt</td>
                    </tr>
                    <tr>
                        <td>1049</td>
                        <td><code>instLocalGapBound</code></td>
                        <td><span class="status blocked">Blocked</span></td>
                        <td>Depends on kernel proof</td>
                    </tr>
                    <tr>
                        <td>1191</td>
                        <td><code>partialResidueMap_zero</code></td>
                        <td><span class="status wip">Active</span></td>
                        <td>Subtype coercion (NEW Cycle 27)</td>
                    </tr>
                    <tr>
                        <td>1200</td>
                        <td><code>partialResidueMap_add</code></td>
                        <td><span class="status wip">Active</span></td>
                        <td>Subtype addition (NEW Cycle 27)</td>
                    </tr>
                    <tr>
                        <td>1211</td>
                        <td><code>partialResidueMap_smul</code></td>
                        <td><span class="status wip">Active</span></td>
                        <td>Scalar multiplication (NEW Cycle 27)</td>
                    </tr>
                </tbody>
            </table>
            <p style="font-size: 0.9rem; color: var(--muted); margin-top: 1rem;">
                <strong>9 total sorries</strong>: 2 deprecated (placeholder code), 7 active (4 on critical path, 3 new linearity proofs)
            </p>
        </section>

        <!-- What We Still Need -->
        <section>
            <h2>What We Still Need</h2>

            <table class="difficulty-table">
                <thead>
                    <tr>
                        <th>Task</th>
                        <th>Description</th>
                        <th>Difficulty</th>
                        <th>Notes</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>partialResidueMap</code> linearity</td>
                        <td>Prove zero, add, smul for partial residue map</td>
                        <td><span class="difficulty easy">Easy</span></td>
                        <td>Subtype coercion pattern (NEW Cycle 27)</td>
                    </tr>
                    <tr>
                        <td>Residue field bridge</td>
                        <td>Show valuationRingAt.residueField = residueFieldAtPrime</td>
                        <td><span class="difficulty medium">Medium</span></td>
                        <td>Key gap identified in Cycle 26</td>
                    </tr>
                    <tr>
                        <td><code>shifted_element_valuation_le_one</code></td>
                        <td>Complete WithZero.exp arithmetic</td>
                        <td><span class="difficulty easy">Easy</span></td>
                        <td>Helper lemmas now in place</td>
                    </tr>
                    <tr>
                        <td><code>evaluationMapAt</code></td>
                        <td>Construct phi : L(D+v) -> kappa(v)</td>
                        <td><span class="difficulty medium">Medium</span></td>
                        <td>Depends on residue field bridge</td>
                    </tr>
                    <tr>
                        <td><code>LocalGapBound</code> instance</td>
                        <td>Make riemann_inequality unconditional</td>
                        <td><span class="difficulty easy">Easy</span></td>
                        <td>Apply local_gap_bound_of_exists_map</td>
                    </tr>
                    <tr>
                        <td>Compactification</td>
                        <td>Add infinite places for l(0) = 1</td>
                        <td><span class="difficulty hard">Hard</span></td>
                        <td>Currently affine model only</td>
                    </tr>
                    <tr>
                        <td>Serre duality</td>
                        <td>l(K-D) = h1(D) from residues</td>
                        <td><span class="difficulty very-hard">Very Hard</span></td>
                        <td>Requires differentials, residue theorem</td>
                    </tr>
                </tbody>
            </table>

            <div class="note info">
                <strong>Cycle 27 Progress:</strong> Defined <code>partialResidueMap</code> to map K-elements (with v(g) &le; 1) to the valuation ring's residue field. Found key mathlib lemma <code>HeightOneSpectrum.mem_integers_of_valuation_le_one</code> confirming why local approach is needed. Three linearity proofs (zero, add, smul) have sorry due to subtype coercion issues.
            </div>
        </section>

        <!-- Affine vs Projective -->
        <section>
            <h2>Key Insight: Affine vs Projective Models</h2>
            <div class="two-col">
                <div class="approach-box">
                    <h4>Affine Model (Current)</h4>
                    <ul>
                        <li>Points = finite places only</li>
                        <li>L(0) = R (all integral functions)</li>
                        <li>l(0) = infinity for Dedekind domains</li>
                        <li>Proves: l(D) &le; deg(D) + l(0)</li>
                    </ul>
                    <p style="font-size: 0.85rem; color: var(--muted);">
                        <strong>Typeclass:</strong> <code>LocalGapBound R K</code>
                    </p>
                </div>
                <div class="approach-box">
                    <h4>Projective Model (Goal)</h4>
                    <ul>
                        <li>Points = finite + infinite places</li>
                        <li>L(0) = k (constants only)</li>
                        <li>l(0) = 1</li>
                        <li>Proves: l(D) &le; deg(D) + 1</li>
                    </ul>
                    <p style="font-size: 0.85rem; color: var(--green);">
                        <strong>Typeclass:</strong> <code>SinglePointBound R K extends LocalGapBound</code>
                    </p>
                </div>
            </div>
            <p style="font-size: 0.9rem; color: var(--muted);">
                Cycle 22 discovered that <code>HeightOneSpectrum R</code> only captures finite places.
                The classical Riemann inequality l(D) &le; deg(D) + 1 requires compactification.
                We cleanly separated this into two typeclasses so proofs work at both levels.
            </p>
        </section>

        <!-- Build Progress -->
        <section>
            <h2>Build Progress by Cycle</h2>
            <table class="status-table">
                <thead>
                    <tr>
                        <th>Cycle</th>
                        <th>Focus</th>
                        <th>Key Results</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>1-3</td>
                        <td>Bootstrap</td>
                        <td>RRData structure, statement elaborates</td>
                        <td><span class="status done">Complete</span></td>
                    </tr>
                    <tr>
                        <td>4-6</td>
                        <td>Foundations</td>
                        <td><code>Divisor</code>, <code>FunctionFieldData</code>, <code>RRSpace</code></td>
                        <td><span class="status done">14 proved</span></td>
                    </tr>
                    <tr>
                        <td>7-9</td>
                        <td>Dimension</td>
                        <td><code>ell = finrank</code>, quotient infrastructure</td>
                        <td><span class="status done">17 proved</span></td>
                    </tr>
                    <tr>
                        <td>10-11</td>
                        <td>Riemann ineq (v1)</td>
                        <td>SinglePointBound axiom, degree induction</td>
                        <td><span class="status done">11 proved</span></td>
                    </tr>
                    <tr>
                        <td>12-16</td>
                        <td>Full RR structure</td>
                        <td>Genus, canonical, vanishing, Clifford</td>
                        <td><span class="status done">28 proved</span></td>
                    </tr>
                    <tr>
                        <td>17</td>
                        <td>Pivot to v2</td>
                        <td>Created RR_v2.lean with Dedekind domains</td>
                        <td><span class="status done">8 proved</span></td>
                    </tr>
                    <tr>
                        <td>18-19</td>
                        <td>Valuation-based L(D)</td>
                        <td><code>RRModuleV2_real</code> complete</td>
                        <td><span class="status done">6 proved</span></td>
                    </tr>
                    <tr>
                        <td>20</td>
                        <td>Monotonicity</td>
                        <td><code>ellV2_real_mono</code> via Module.length</td>
                        <td><span class="status done">5 proved</span></td>
                    </tr>
                    <tr>
                        <td>21</td>
                        <td>Riemann ineq (v2)</td>
                        <td><code>riemann_inequality_real</code> PROVED</td>
                        <td><span class="status done">8 proved</span></td>
                    </tr>
                    <tr>
                        <td>22</td>
                        <td>Discovery</td>
                        <td>Affine model limitation identified</td>
                        <td><span class="status done">3 proved</span></td>
                    </tr>
                    <tr>
                        <td>23</td>
                        <td>Typeclass hierarchy</td>
                        <td><code>LocalGapBound</code> / <code>SinglePointBound</code> split</td>
                        <td><span class="status done">8 proved</span></td>
                    </tr>
                    <tr>
                        <td>24.1</td>
                        <td>Linear algebra bridge</td>
                        <td><code>local_gap_bound_of_exists_map</code>, <code>isSimpleModule</code></td>
                        <td><span class="status done">6 proved</span></td>
                    </tr>
                    <tr>
                        <td>24.2</td>
                        <td>Uniformizer infrastructure</td>
                        <td><code>uniformizerAt</code>, valuation lemmas</td>
                        <td><span class="status done">6 proved</span></td>
                    </tr>
                    <tr>
                        <td>25</td>
                        <td>Integration</td>
                        <td>Blocker identified (residue field bridge)</td>
                        <td><span class="status wip">Partial</span></td>
                    </tr>
                    <tr>
                        <td>26</td>
                        <td>Valuation ring</td>
                        <td><code>valuationRingAt</code>, local ring infrastructure</td>
                        <td><span class="status done">8 proved</span></td>
                    </tr>
                    <tr>
                        <td>27</td>
                        <td>Partial residue map</td>
                        <td><code>partialResidueMap</code>, WithZero.exp helpers</td>
                        <td><span class="status wip">5 OK, 3 sorry</span></td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- What's Next -->
        <section>
            <h2>What's Next (Cycle 28)</h2>
            <h3>Immediate Goals</h3>
            <ul style="margin: 1rem 0; padding-left: 1.5rem;">
                <li><strong>Fix partialResidueMap linearity</strong> &mdash; Resolve subtype coercion issues in zero/add/smul proofs</li>
                <li><strong>Bridge residue fields</strong> &mdash; Show <code>valuationRingAt.residueField v</code> is isomorphic to <code>residueFieldAtPrime R v</code></li>
                <li><strong>Complete shifted valuation lemma</strong> &mdash; Use <code>withzero_exp_mul_le_one</code> helper</li>
                <li><strong>Construct evaluation map</strong> &mdash; Map shifted element through valuation ring residue to kappa(v)</li>
                <li><strong>Instantiate LocalGapBound</strong> &mdash; Apply <code>local_gap_bound_of_exists_map</code></li>
            </ul>

            <h3 style="margin-top: 1.5rem;">Stretch Goals</h3>
            <ul style="margin: 1rem 0; padding-left: 1.5rem;">
                <li><strong>Compactification</strong> &mdash; Add infinite places to get l(0) = 1</li>
                <li><strong>Serre duality</strong> &mdash; Would require differentials, residue map, residue theorem</li>
                <li><strong>Full constructive RR</strong> &mdash; Remove all axioms from RR.lean by instantiation</li>
            </ul>

            <h3 style="margin-top: 1.5rem;">What We Won't Do</h3>
            <p style="color: var(--muted);">
                Schemes, sheaf cohomology, or full line bundle theory. These are complexity cliffs that
                would transform this from "Riemann-Roch formalization" into "algebraic geometry library."
            </p>
        </section>

        <!-- Meta: Process -->
        <section>
            <h2>Meta: How This Project Evolved</h2>

            <p style="margin-bottom: 1.5rem;">
                This project used an <strong>ACE-style orchestration loop</strong>: an LLM (Claude) guided by
                a human through iterative "cycles" of planning, implementation, and review. Each cycle
                targets a specific edge of the proof graph, builds it, tests it, and commits.
            </p>

            <div class="two-col">
                <div class="approach-box">
                    <h4 style="color: var(--green);">What Worked Well</h4>
                    <ul>
                        <li><strong>Iterative cycles</strong> &mdash; Small, focused commits kept progress visible and reversible</li>
                        <li><strong>Two-file strategy</strong> &mdash; Axiom-based (RR.lean) let us explore consequences while constructive (RR_v2.lean) built foundations</li>
                        <li><strong>Typeclass abstraction</strong> &mdash; <code>LocalGapBound</code> / <code>SinglePointBound</code> hierarchy cleanly separated affine vs projective concerns</li>
                        <li><strong>Module.length over finrank</strong> &mdash; Key pivot in Cycle 20; length is additive in exact sequences, finrank isn't</li>
                        <li><strong>Valuation ring approach</strong> &mdash; Cycle 26 insight: use local condition at single prime rather than global integrality</li>
                        <li><strong>State files</strong> &mdash; playbook.md and ledger.md provided persistent memory across sessions</li>
                    </ul>
                </div>
                <div class="approach-box">
                    <h4 style="color: var(--red);">What Was Hard / Didn't Work</h4>
                    <ul>
                        <li><strong>Instance plumbing</strong> &mdash; Lean's typeclass system sometimes times out on "obvious" instances</li>
                        <li><strong>Affine model surprise</strong> &mdash; Cycle 22 discovered HeightOneSpectrum only gives finite places; took 3 cycles to cleanly resolve</li>
                        <li><strong>finrank dead end</strong> &mdash; Cycles 17-19 tried finrank-based dimension; had to pivot when monotonicity failed</li>
                        <li><strong>API exploration</strong> &mdash; Finding the right mathlib lemma often took longer than writing the proof</li>
                        <li><strong>Residue field gap</strong> &mdash; Multiple constructions of "residue field at v" that don't match definitionally</li>
                    </ul>
                </div>
            </div>

            <h3 style="margin-top: 1.5rem;">Key Pivots</h3>
            <table class="status-table">
                <thead>
                    <tr>
                        <th>Cycle</th>
                        <th>Discovery</th>
                        <th>Response</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>17</td>
                        <td>Axiom approach hit ceiling; couldn't instantiate</td>
                        <td>Created RR_v2.lean with Dedekind domain foundations</td>
                    </tr>
                    <tr>
                        <td>20</td>
                        <td>finrank not monotonic for infinite-dimensional quotients</td>
                        <td>Switched to Module.length (ENat-valued, additive)</td>
                    </tr>
                    <tr>
                        <td>22</td>
                        <td>HeightOneSpectrum = finite places only</td>
                        <td>Split into LocalGapBound (affine) + SinglePointBound (projective)</td>
                    </tr>
                    <tr>
                        <td>24</td>
                        <td>IsFractionRing timeout blocking isSimpleModule</td>
                        <td>Found bijective_algebraMap lemma, avoided IsFractionRing entirely</td>
                    </tr>
                    <tr>
                        <td>26</td>
                        <td>Shifted element may have poles at other primes (not in R)</td>
                        <td>Introduced valuationRingAt (local condition at single prime)</td>
                    </tr>
                    <tr>
                        <td>27</td>
                        <td>partialResidueMap linearity blocked on subtype coercions</td>
                        <td>Identified Subtype.ext pattern needed; mathlib confirms local approach</td>
                    </tr>
                </tbody>
            </table>

            <h3 style="margin-top: 1.5rem;">Honest Assessment</h3>
            <p style="margin-bottom: 1rem;">
                <strong>What we achieved:</strong> A working proof of the Riemann inequality from Dedekind domain
                foundations, plus a complete axiom-based development of RR consequences (genus formulas, Clifford).
                The core algebraic machinery is solid.
            </p>
            <p style="margin-bottom: 1rem;">
                <strong>What's missing for "real" RR:</strong> The l(K-D) term requires Serre duality, which requires
                differentials, residues, and the residue theorem. This is substantial algebraic geometry that
                mathlib doesn't have. We'd need to either axiomatize it (like we did) or build it from scratch
                (months of work).
            </p>
            <p style="color: var(--muted);">
                <strong>Bottom line:</strong> This is an honest partial formalization. We proved the "easy half"
                (Riemann inequality) constructively and axiomatized the "hard half" (duality). The axiom-based
                results are mathematically valid conditional on RR holding; the constructive results are unconditional.
            </p>
        </section>

        <footer>
            <p>
                Lean 4 + mathlib &bull;
                <a href="https://github.com/cguth7/roch-riemann">GitHub</a> &bull;
                Cycle 27 &bull;
                Last updated: Dec 16, 2024
            </p>
        </footer>
    </div>
</body>
</html>
