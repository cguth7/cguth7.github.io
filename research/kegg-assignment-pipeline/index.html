<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KEGG Assignment Pipeline | Gemini Pathways</title>
    <style>
        :root {
            --bg: #fafafa;
            --surface: #ffffff;
            --border: #e0e0e0;
            --text: #333;
            --text-muted: #666;
            --accent: #2563eb;
            --accent-light: #dbeafe;
            --green: #16a34a;
            --green-light: #dcfce7;
            --amber: #d97706;
            --amber-light: #fef3c7;
            --red: #dc2626;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            padding: 2rem 1rem;
        }
        .container { max-width: 1000px; margin: 0 auto; }
        header { margin-bottom: 2rem; padding-bottom: 1.5rem; border-bottom: 1px solid var(--border); }
        h1 { font-size: 1.8rem; font-weight: 600; margin-bottom: 0.5rem; }
        .subtitle { color: var(--text-muted); font-size: 1.05rem; }
        .breadcrumb { margin-top: 0.5rem; font-size: 0.85rem; color: var(--text-muted); }
        .breadcrumb a { color: var(--accent); text-decoration: none; }

        h2 {
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
            margin: 2.5rem 0 1rem 0;
        }
        h3 { font-size: 1.1rem; font-weight: 600; margin: 1.5rem 0 0.75rem 0; }

        .card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .card p { margin-bottom: 0.75rem; color: var(--text-muted); font-size: 0.95rem; }
        .card p:last-child { margin-bottom: 0; }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        .stat-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1.25rem;
            text-align: center;
        }
        .stat-value { font-size: 1.6rem; font-weight: 700; color: var(--accent); }
        .stat-label { font-size: 0.8rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.03em; margin-top: 0.25rem; }

        .prompt-block {
            background: #1e1e2e;
            color: #cdd6f4;
            border-radius: 6px;
            padding: 1.25rem;
            overflow-x: auto;
            font-size: 0.8rem;
            line-height: 1.5;
            margin: 1rem 0;
            white-space: pre-wrap;
            font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace;
            max-height: 600px;
            overflow-y: auto;
            position: relative;
        }

        .kegg-block {
            background: #f8f8f0;
            border: 1px solid #e0ddd0;
            border-radius: 6px;
            padding: 1rem;
            font-size: 0.72rem;
            line-height: 1.4;
            font-family: monospace;
            max-height: 200px;
            overflow-y: auto;
            margin: 0.75rem 0;
            color: #555;
        }

        .output-example {
            background: #1a2332;
            color: #e2e8f0;
            border-radius: 6px;
            padding: 1.25rem;
            font-size: 0.82rem;
            line-height: 1.5;
            font-family: monospace;
            margin: 1rem 0;
            white-space: pre-wrap;
        }
        .output-example .key { color: #7dd3fc; }
        .output-example .str { color: #86efac; }
        .output-example .num { color: #fbbf24; }

        .pipeline-flow {
            display: flex;
            align-items: center;
            gap: 0;
            margin: 1.5rem 0;
            flex-wrap: wrap;
        }
        .pipeline-step {
            background: var(--surface);
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            text-align: center;
            min-width: 120px;
        }
        .pipeline-step.active { border-color: var(--accent); background: var(--accent-light); }
        .pipeline-step.done { border-color: var(--green); background: var(--green-light); }
        .pipeline-step.pending { border-color: var(--border); opacity: 0.7; }
        .pipeline-step .step-label { font-size: 0.72rem; color: var(--text-muted); text-transform: uppercase; }
        .pipeline-step .step-name { font-weight: 600; font-size: 0.9rem; margin-top: 0.2rem; }
        .pipeline-arrow { font-size: 1.2rem; color: var(--text-muted); padding: 0 0.5rem; }

        table { width: 100%; border-collapse: collapse; margin: 1rem 0; font-size: 0.9rem; }
        th { text-align: left; padding: 0.6rem 0.75rem; border-bottom: 2px solid var(--border); font-weight: 600; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.03em; color: var(--text-muted); }
        td { padding: 0.6rem 0.75rem; border-bottom: 1px solid #f0f0f0; }
        tr:hover td { background: #f8f8f8; }

        .tag {
            display: inline-block;
            padding: 0.15rem 0.5rem;
            border-radius: 3px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        .tag-green { background: var(--green-light); color: var(--green); }
        .tag-amber { background: var(--amber-light); color: var(--amber); }
        .tag-red { background: #fee2e2; color: var(--red); }
        .tag-blue { background: var(--accent-light); color: var(--accent); }

        .note {
            background: var(--amber-light);
            border-left: 3px solid var(--amber);
            padding: 0.75rem 1rem;
            margin: 1rem 0;
            font-size: 0.9rem;
            border-radius: 0 6px 6px 0;
        }

        footer {
            margin-top: 3rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border);
            color: var(--text-muted);
            font-size: 0.85rem;
        }
        footer a { color: var(--accent); text-decoration: none; }

        .bar-chart { margin: 1rem 0; }
        .bar-row { display: flex; align-items: center; margin-bottom: 0.5rem; }
        .bar-label { width: 180px; font-size: 0.85rem; color: var(--text); flex-shrink: 0; }
        .bar-track { flex: 1; height: 24px; background: #f0f0f0; border-radius: 4px; overflow: hidden; position: relative; }
        .bar-fill { height: 100%; border-radius: 4px; display: flex; align-items: center; padding-left: 8px; font-size: 0.72rem; color: white; font-weight: 600; min-width: fit-content; }
        .bar-fill.green { background: var(--green); }
        .bar-fill.blue { background: var(--accent); }
        .bar-fill.amber { background: var(--amber); }
        .bar-fill.red { background: var(--red); }
        .bar-count { margin-left: 0.75rem; font-size: 0.8rem; color: var(--text-muted); flex-shrink: 0; width: 100px; }

        .breakdown-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin: 1rem 0;
        }
        @media (max-width: 700px) { .breakdown-grid { grid-template-columns: 1fr; } }
        .breakdown-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1.25rem;
        }
        .breakdown-card h4 {
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.03em;
            color: var(--text-muted);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border);
        }
        .breakdown-card .big-num { font-size: 2rem; font-weight: 700; }
        .breakdown-card .big-num.green { color: var(--green); }
        .breakdown-card .big-num.amber { color: var(--amber); }

        .run-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1.25rem;
            margin-bottom: 1rem;
        }
        .run-card h4 { font-size: 1rem; font-weight: 600; margin-bottom: 0.5rem; }
        .run-card code {
            background: #f0f0f0;
            padding: 0.15rem 0.4rem;
            border-radius: 3px;
            font-size: 0.82rem;
        }
        .run-card .cmd {
            background: #1e1e2e;
            color: #a6e3a1;
            padding: 0.6rem 1rem;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.82rem;
            margin: 0.75rem 0;
        }
    </style>
</head>
<body>
<div class="container">

<header>
    <h1>KEGG Assignment Pipeline</h1>
    <p class="subtitle">Assigning KEGG pathway IDs to ~49k pathway images via Gemini 3 Pro analysis of captions and PubMed metadata</p>
    <nav class="breadcrumb">
        <a href="/research/gemini-pathways/">Gemini Pathways</a> / <span>KEGG Assignment Pipeline</span>
    </nav>
</header>

<!-- Pipeline Status -->
<h2>Pipeline Overview</h2>

<div class="pipeline-flow">
    <div class="pipeline-step done">
        <div class="step-label">Signal 1</div>
        <div class="step-name">Jaccard</div>
    </div>
    <span class="pipeline-arrow">&rarr;</span>
    <div class="pipeline-step active">
        <div class="step-label">Signal 2</div>
        <div class="step-name">Caption LLM</div>
    </div>
    <span class="pipeline-arrow">&rarr;</span>
    <div class="pipeline-step active">
        <div class="step-label">Signal 3</div>
        <div class="step-name">Metadata LLM</div>
    </div>
    <span class="pipeline-arrow">&rarr;</span>
    <div class="pipeline-step pending">
        <div class="step-label">Output</div>
        <div class="step-name">Final CSVs</div>
    </div>
</div>

<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-value">48,779</div>
        <div class="stat-label">Total Images</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">34,062</div>
        <div class="stat-label">Have Captions</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">42,362</div>
        <div class="stat-label">Papers w/ Metadata</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">239</div>
        <div class="stat-label">KEGG Pathways</div>
    </div>
</div>

<!-- The Execution Plan -->
<h2>Execution Plan</h2>

<div class="run-card">
    <h4>Run 1: Caption Assignment (Signal 2)</h4>
    <p style="color:var(--text-muted); font-size:0.9rem;">Send each figure caption + 239 KEGG pathways to Gemini 3 Pro. Figure-level signal &mdash; strongest assignment.</p>
    <table style="font-size:0.85rem; margin:0.5rem 0;">
        <tr><td style="width:140px;">LLM calls</td><td><strong>34,062</strong> (one per captioned image)</td></tr>
        <tr><td>Model</td><td>Gemini 3 Pro (Vertex AI)</td></tr>
        <tr><td>Throughput</td><td>~120&ndash;165/min sustained</td></tr>
        <tr><td>Est. time</td><td><strong>~4.7 hours</strong></td></tr>
        <tr><td>Cost</td><td>Free (GCP credits)</td></tr>
        <tr><td>Output</td><td><code>intermediate/caption_assignments.json</code></td></tr>
    </table>
    <div class="cmd">caffeinate -s python scripts/run_caption_assignment_gemini.py --full</div>
</div>

<div class="run-card">
    <h4>Run 2: Metadata Assignment (Signal 3)</h4>
    <p style="color:var(--text-muted); font-size:0.9rem;">Send paper title + abstract + MeSH + keywords + 239 KEGG pathways to Gemini 3 Pro. Paper-level signal &mdash; run for <strong>all</strong> papers, not just captionless. Deduped by PMC ID.</p>
    <table style="font-size:0.85rem; margin:0.5rem 0;">
        <tr><td style="width:140px;">LLM calls</td><td><strong>42,362</strong> (one per unique paper)</td></tr>
        <tr><td>Model</td><td>Gemini 3 Pro (Vertex AI)</td></tr>
        <tr><td>Throughput</td><td>~120&ndash;165/min sustained</td></tr>
        <tr><td>Est. time</td><td><strong>~5.9 hours</strong></td></tr>
        <tr><td>Cost</td><td>Free (GCP credits)</td></tr>
        <tr><td>Output</td><td><code>intermediate/metadata_assignments.json</code></td></tr>
    </table>
    <div class="cmd">caffeinate -s python scripts/run_metadata_assignment_gemini.py --full</div>
    <div class="note" style="margin-top:0.75rem;">
        Metadata assignment is paper-level: one paper may have multiple figures showing different pathways. Results fan out to all images from that paper. Running for all papers (not just captionless) gives an independent validation signal for captioned images too.
    </div>
</div>

<div class="run-card">
    <h4>Run 3: Build Final CSVs</h4>
    <p style="color:var(--text-muted); font-size:0.9rem;">Merge all signals into three deliverable CSVs. No API calls.</p>
    <div class="cmd">python scripts/build_edges.py && python scripts/build_nodes.py && python scripts/build_metadata.py</div>
    <table style="font-size:0.85rem; margin:0.5rem 0;">
        <tr><td style="width:140px;">Output</td><td><code>output/edges.csv</code>, <code>output/nodes.csv</code>, <code>output/metadata.csv</code></td></tr>
    </table>
</div>

<!-- Signal Coverage -->
<h2>Signal Coverage After Both Runs</h2>

<div class="bar-chart">
    <div class="bar-row">
        <div class="bar-label">Gemini annotation</div>
        <div class="bar-track"><div class="bar-fill green" style="width:100%">100%</div></div>
        <div class="bar-count">48,779</div>
    </div>
    <div class="bar-row">
        <div class="bar-label">Metadata LLM (Signal 3)</div>
        <div class="bar-track"><div class="bar-fill green" style="width:99.9%">99.9%</div></div>
        <div class="bar-count">48,738</div>
    </div>
    <div class="bar-row">
        <div class="bar-label">Jaccard score &gt; 0</div>
        <div class="bar-track"><div class="bar-fill green" style="width:97.4%">97.4%</div></div>
        <div class="bar-count">47,526</div>
    </div>
    <div class="bar-row">
        <div class="bar-label">Caption LLM (Signal 2)</div>
        <div class="bar-track"><div class="bar-fill blue" style="width:69.8%">69.8%</div></div>
        <div class="bar-count">34,062</div>
    </div>
</div>

<div class="card">
    <p><strong>After both runs:</strong> 34,039 images get both caption AND metadata signals (cross-validation). 14,699 captionless images get metadata only. Only 18 images (~0.04%) have no caption and no PubMed metadata &mdash; these get Jaccard + Gemini label only.</p>
</div>

<!-- Model Comparison -->
<h2>Model Comparison &amp; Throughput Testing</h2>

<div class="card">
    <p>Tested 4 models on the caption assignment task. Gemini 3 Pro is the clear winner: best quality, free via credits, and fast enough with the native async client.</p>
    <table>
        <thead>
            <tr><th>Model</th><th>RPM</th><th>34k time</th><th>Cost</th><th>Quality</th><th>Reasoning</th><th>Status</th></tr>
        </thead>
        <tbody>
            <tr>
                <td><strong>Gemini 3 Pro</strong></td>
                <td>120&ndash;165</td>
                <td><strong>~4.7 hrs</strong></td>
                <td>Free</td>
                <td>Baseline (best)</td>
                <td>Yes</td>
                <td><span class="tag tag-green">Selected</span></td>
            </tr>
            <tr>
                <td>GPT-4o-mini</td>
                <td>~200</td>
                <td>~3 hrs</td>
                <td>~$20</td>
                <td>70% agree w/ Pro</td>
                <td>Yes</td>
                <td><span class="tag tag-blue">Backup</span></td>
            </tr>
            <tr>
                <td>Gemini 2.0 Flash</td>
                <td>716</td>
                <td>~47 min</td>
                <td>Free</td>
                <td>Untested</td>
                <td>Untested</td>
                <td><span class="tag tag-amber">Not used</span></td>
            </tr>
            <tr>
                <td>Gemini 2.5 Flash</td>
                <td>68</td>
                <td>~8.3 hrs</td>
                <td>Free</td>
                <td>65% agree w/ Pro</td>
                <td><span style="color:var(--red)">Drops field</span></td>
                <td><span class="tag tag-red">Rejected</span></td>
            </tr>
        </tbody>
    </table>

    <div class="note">
        <strong>Key finding:</strong> Gemini 3 Pro was initially measured at 30 RPM using a sync client. Switching to the native async client (<code>client.aio.models.generate_content</code>) with concurrency 200 yields 120&ndash;165 RPM &mdash; matching the original 49k image annotation throughput. The bottleneck was the test harness, not the model.
    </div>
</div>

<!-- Robustness -->
<h2>Script Robustness</h2>

<div class="card">
    <p>Both assignment scripts are built for unattended overnight runs:</p>
    <table style="font-size:0.85rem;">
        <tr><td style="width:200px;">Semaphore per-call</td><td>Released between retries &mdash; stuck calls don't block other work</td></tr>
        <tr><td>Atomic checkpoints</td><td>Write to .tmp then <code>os.replace()</code> &mdash; crash-safe</td></tr>
        <tr><td>Batched processing</td><td>500 images per batch, checkpoint between batches</td></tr>
        <tr><td>Graceful shutdown</td><td>Ctrl-C saves progress, resume with <code>--resume</code></td></tr>
        <tr><td>Circuit breaker</td><td>Pauses 2 min if &gt;50% error rate over 50 calls</td></tr>
        <tr><td>Task deadline</td><td>120s max per image (all retries) &mdash; no infinite hangs</td></tr>
        <tr><td>Resume</td><td><code>--resume</code> skips already-processed items, handles corrupted files</td></tr>
    </table>
</div>

<!-- Prompt 1: Caption -->
<h2>Prompt 1: Caption &rarr; KEGG Assignment</h2>

<div class="card">
    <p>Sent for each of the 34,062 images with a figure caption. The <code>{caption}</code> placeholder is replaced with the actual caption text (up to 1000 chars). The <code>{kegg_list}</code> placeholder is replaced with all 239 KEGG pathways.</p>
</div>

<div class="prompt-block" id="prompt1">You are a biomedical pathway expert. Given a figure caption from a scientific paper,
identify which KEGG human signaling/metabolic pathway the figure most specifically depicts.

FIGURE CAPTION:
<span style="color:#fab387">{caption}</span>

KEGG HUMAN PATHWAYS:
<span style="color:#6c7086">{kegg_list}  &larr; 239 pathways, shown below</span>

INSTRUCTIONS:
1. Read the caption carefully. Identify the specific biological pathway or process shown.
2. Use your biomedical expertise to identify the KEGG pathway even if the exact pathway
   name is not stated in the caption. For example: if the caption mentions "metformin,"
   recognize it acts through AMPK signaling (hsa04152). If it mentions "PERK/eIF2alpha/ATF4/CHOP,"
   recognize this as the UPR branch within "Protein processing in endoplasmic reticulum" (hsa04141).
   Map from biological knowledge, not just keyword matching.
3. Match it to the single most specific KEGG pathway from the list above. Read the FULL list
   carefully &mdash; KEGG pathway names are sometimes non-obvious (e.g., "Protein processing in
   endoplasmic reticulum" covers the Unfolded Protein Response; "Glycerophospholipid metabolism"
   covers choline/phosphatidylcholine pathways).
4. Only respond with "none" if NONE of the biological processes in the caption can be mapped
   to ANY pathway in the KEGG list. If the caption describes a disease mechanism or drug effect
   that operates THROUGH a specific KEGG pathway, assign that pathway. Reserve "none" for:
   purely methodological figures, generic network visualizations, or captions too vague to
   identify any specific pathway.
5. Prefer specific pathways over broad ones. For example, if the caption clearly describes
   Wnt signaling, choose "Wnt signaling pathway" not "Pathways in cancer".
6. If the caption describes crosstalk or interaction between two specific pathways, choose
   the pathway that is the PRIMARY subject of the figure (usually the one in the title or
   first mentioned). If truly equal, choose the more specific of the two.

Respond in JSON only:
{"kegg_id": "hsaXXXXX or none", "kegg_name": "pathway name or none", "confidence": 0.0-1.0, "reasoning": "one sentence explaining your choice"}

CONFIDENCE SCALE (use strictly):
- 1.0: Caption explicitly names the KEGG pathway or its canonical synonym
- 0.8: Caption names key pathway components (&gt;2 specific genes/proteins from the pathway)
- 0.6: Caption implies the pathway through drug/disease/mechanism inference
- 0.4: Caption is ambiguous between 2-3 possible KEGG pathways
- 0.2: Weak/indirect evidence only
- 0.0: No pathway information in caption (returning "none")</div>

<!-- Prompt 2: Metadata -->
<h2>Prompt 2: PubMed Metadata &rarr; KEGG Assignment</h2>

<div class="card">
    <p>Sent for each of the 42,362 unique papers with PubMed metadata. Results fan out to all images from that paper. Abstract truncated to 2000 chars. MeSH descriptors comma-joined.</p>
</div>

<div class="prompt-block" id="prompt2">You are a biomedical pathway expert. A scientific paper contains pathway diagram figures,
but the figure captions are not available. Using the paper's metadata below, identify
which KEGG human signaling/metabolic pathway the paper most likely depicts in its figures.

PAPER TITLE: <span style="color:#fab387">{title}</span>

ABSTRACT (truncated): <span style="color:#fab387">{abstract}</span>

MeSH TERMS: <span style="color:#fab387">{mesh_terms}</span>

AUTHOR KEYWORDS: <span style="color:#fab387">{keywords}</span>

KEGG HUMAN PATHWAYS:
<span style="color:#6c7086">{kegg_list}  &larr; same 239 pathways</span>

INSTRUCTIONS:
1. This is paper-level metadata, not figure-level. The paper may discuss multiple pathways.
2. Use your biomedical expertise to identify the KEGG pathway even if not named verbatim.
3. Identify the single most prominent pathway discussed in this paper.
4. Only respond with "none" if the paper doesn't focus on any specific KEGG pathway.
5. Prefer specific pathways over broad ones.
6. Note: this assignment is inherently lower confidence than caption-based assignment
   since we're matching paper-level info to figure-level pathways.

Respond in JSON only:
{"kegg_id": "hsaXXXXX or none", "kegg_name": "pathway name or none", "confidence": 0.0-1.0, "reasoning": "one sentence explaining your choice"}

CONFIDENCE SCALE (use strictly):
- 1.0: Paper title explicitly names the KEGG pathway
- 0.8: Abstract describes key pathway components in detail
- 0.6: MeSH terms or keywords strongly suggest a specific pathway
- 0.4: Multiple pathways discussed, one slightly more prominent
- 0.2: Weak/indirect evidence only
- 0.0: No pathway information (returning "none")</div>

<!-- KEGG Reference List -->
<h2>KEGG Reference List (fed to both prompts)</h2>

<div class="card">
    <p>The full list of 239 human KEGG pathways that both prompts receive. This is the menu of options the LLM picks from.</p>
</div>

<div class="kegg-block" id="kegg-list">Loading...</div>

<!-- Expected Output -->
<h2>Expected Output</h2>

<div class="card">
    <p>Each LLM call returns one JSON object. Caption assignments are keyed by filename (image-level). Metadata assignments are keyed by PMC ID (paper-level, fanned out to all images in <code>build_metadata.py</code>).</p>

    <h3>Per-image LLM response</h3>
</div>

<div class="output-example"><span class="key">"pmc_id"</span>: <span class="str">"PMC3056141"</span>,
<span class="key">"filename"</span>: <span class="str">"PMC3056141__F1.jpg"</span>,
<span class="key">"kegg_id"</span>: <span class="str">"hsa04620"</span>,
<span class="key">"kegg_name"</span>: <span class="str">"Toll-like receptor signaling pathway"</span>,
<span class="key">"confidence"</span>: <span class="num">1.0</span>,
<span class="key">"reasoning"</span>: <span class="str">"The caption explicitly describes TLR9-dependent innate immune signaling, which is a key component of the Toll-like receptor signaling pathway."</span></div>

<div class="card">
    <h3>Final <code>metadata.csv</code> columns</h3>
    <p>One row per image. The main deliverable &mdash; all three signals merged:</p>
</div>

<div class="output-example"><span class="key">pmc_id</span>          &mdash; PMC article ID
<span class="key">filename</span>        &mdash; image filename
<span class="key">figure_number</span>   &mdash; extracted figure number (F1, F2, ...)
<span class="key">gemini_label</span>    &mdash; Gemini's free-form pathway name
<span class="key">gemini_related</span>  &mdash; related pathways (pipe-delimited)
<span class="key">n_genes</span>         &mdash; number of Entrez genes extracted

<span style="color:#6c7086">--- Signal 1: Jaccard ---</span>
<span class="key">jaccard_kegg_id</span>   &mdash; best KEGG match by gene overlap
<span class="key">jaccard_kegg_name</span> &mdash; pathway name
<span class="key">jaccard_score</span>     &mdash; Jaccard similarity (0-1)

<span style="color:#6c7086">--- Signal 2: Caption LLM ---</span>
<span class="key">caption_kegg_id</span>   &mdash; KEGG ID from caption analysis
<span class="key">caption_kegg_name</span> &mdash; pathway name
<span class="key">caption_confidence</span>&mdash; 0.0-1.0 (strict scale)
<span class="key">caption_reasoning</span> &mdash; one-sentence explanation

<span style="color:#6c7086">--- Signal 3: Metadata LLM ---</span>
<span class="key">metadata_kegg_id</span>   &mdash; KEGG ID from paper metadata
<span class="key">metadata_kegg_name</span> &mdash; pathway name
<span class="key">metadata_confidence</span>&mdash; 0.0-1.0 (strict scale)
<span class="key">metadata_reasoning</span> &mdash; one-sentence explanation

<span class="key">year</span>             &mdash; publication year</div>

<!-- File Locations -->
<h2>File Locations</h2>

<div class="card">
    <table style="font-size:0.85rem;">
        <thead>
            <tr><th>File</th><th>Location</th><th>Records</th></tr>
        </thead>
        <tbody>
            <tr><td>Gemini annotations</td><td><code>~/work/gemini_cell_pathways/gemini3_annotations/full_49k_v2_2026-01-26_clean.jsonl</code></td><td>48,974</td></tr>
            <tr><td>Figure captions</td><td><code>~/work/gemini_cell_pathways/data/pmc_caption_pathways_full.json</code></td><td>34,062</td></tr>
            <tr><td>PubMed metadata</td><td><code>~/work/gemini_cell_pathways/data/pubmed_metadata_full.json</code></td><td>42,362</td></tr>
            <tr><td>KEGG pathways</td><td><code>~/work/gemini_cell_pathways/data/kegg_human_pathways.json</code></td><td>239</td></tr>
            <tr><td>Jaccard scores</td><td><code>~/work/gemini_cell_pathways/data/image_pathway_scores.csv</code></td><td>48,779</td></tr>
            <tr><td colspan="3" style="border-bottom:2px solid var(--border);font-weight:600;padding-top:1rem;">Generated by this pipeline</td></tr>
            <tr><td>Caption assignments</td><td><code>~/work/gemini-pathways-final/intermediate/caption_assignments.json</code></td><td>34,062</td></tr>
            <tr><td>Metadata assignments</td><td><code>~/work/gemini-pathways-final/intermediate/metadata_assignments.json</code></td><td>42,362</td></tr>
            <tr><td>Final edges</td><td><code>~/work/gemini-pathways-final/output/edges.csv</code></td><td>&mdash;</td></tr>
            <tr><td>Final nodes</td><td><code>~/work/gemini-pathways-final/output/nodes.csv</code></td><td>&mdash;</td></tr>
            <tr><td>Final metadata</td><td><code>~/work/gemini-pathways-final/output/metadata.csv</code></td><td>~48,779</td></tr>
        </tbody>
    </table>
</div>

<footer>
    <p>Part of the <a href="/research/gemini-pathways/">Gemini Pathways</a> project &mdash; Last updated Feb 10, 2026</p>
</footer>

</div>

<script>
fetch('kegg_list.txt')
    .then(r => r.text())
    .then(text => {
        document.getElementById('kegg-list').textContent = text;
    })
    .catch(() => {
        document.getElementById('kegg-list').textContent = '(Failed to load kegg_list.txt)';
    });
</script>
</body>
</html>
