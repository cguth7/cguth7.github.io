<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hippo Label Validation - All Pathways Comparison</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        header {
            background: linear-gradient(135deg, #1a5276, #2980b9);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
        }
        h1 { font-size: 1.8em; margin-bottom: 10px; }
        .subtitle { opacity: 0.9; font-size: 1.1em; }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .summary-card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .summary-card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 8px;
        }
        .big-stat {
            text-align: center;
            padding: 20px 0;
        }
        .big-stat .number {
            font-size: 3em;
            font-weight: 700;
            color: #2980b9;
        }
        .big-stat .label {
            font-size: 0.95em;
            color: #666;
            margin-top: 5px;
        }
        .stat-row { display: flex; justify-content: space-between; margin: 10px 0; }
        .stat-label { color: #666; }
        .stat-value { font-weight: 600; color: #2c3e50; }
        .stat-good { color: #27ae60; }
        .stat-warn { color: #e67e22; }
        .stat-bad { color: #e74c3c; }

        .chart-container {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .chart-container h3 {
            color: #2c3e50;
            margin-bottom: 20px;
        }

        .bar-row { display: flex; align-items: center; margin: 12px 0; }
        .bar-label { width: 350px; font-size: 0.9em; color: #555; flex-shrink: 0; }
        .bar-track { flex: 1; background: #e0e0e0; height: 28px; border-radius: 4px; overflow: hidden; }
        .bar-fill {
            height: 100%;
            border-radius: 4px;
            display: flex;
            align-items: center;
            padding-left: 10px;
        }
        .bar-fill span { color: white; font-size: 0.85em; font-weight: 600; text-shadow: 0 1px 2px rgba(0,0,0,0.3); }
        .bar-kegg { background: linear-gradient(90deg, #3498db, #2980b9); }
        .bar-wiki { background: linear-gradient(90deg, #27ae60, #229954); }
        .bar-other { background: linear-gradient(90deg, #e67e22, #d35400); }

        .table-wrapper { overflow-x: auto; border-radius: 8px; }
        table {
            width: 100%;
            min-width: 800px;
            border-collapse: collapse;
            font-size: 0.9em;
        }
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        th { background: #f8f9fa; font-weight: 600; color: #2c3e50; }
        tr:hover { background: #f8f9fa; }
        tr.hippo-match { background: #e8f5e9; }
        tr.non-hippo-match { background: #fff3e0; }
        .pmc-link { color: #3498db; text-decoration: none; font-weight: 500; }
        .pmc-link:hover { text-decoration: underline; }
        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.75em;
            font-weight: 600;
        }
        .badge-hippo { background: #27ae60; color: white; }
        .badge-other { background: #e67e22; color: white; }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .tab {
            padding: 10px 20px;
            background: #e0e0e0;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 500;
        }
        .tab.active { background: #3498db; color: white; }

        .explanation {
            background: #e8f4fd;
            border-left: 4px solid #3498db;
            padding: 15px 20px;
            margin-bottom: 25px;
            border-radius: 0 8px 8px 0;
        }
        .explanation p { margin: 8px 0; }
        .explanation strong { color: #2c3e50; }

        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #666;
            font-size: 0.9em;
        }

        .loading { text-align: center; padding: 40px; color: #666; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Hippo Label Validation</h1>
            <p class="subtitle">Do images labeled "Hippo" actually match Hippo pathways best?</p>
        </header>

        <div class="explanation">
            <p><strong>What this shows:</strong> We compare each "Hippo" labeled image against ALL 239 KEGG and 984 WikiPathways to verify the labeling.</p>
            <p><strong>Key question:</strong> If an image is labeled "Hippo signaling", does it have highest gene overlap with Hippo pathways, or does it actually match PI3K-AKT or some other pathway better?</p>
            <p><strong>Method:</strong> Pure Jaccard similarity (gene overlap / gene union) using Entrez IDs.</p>
        </div>

        <div id="content">
            <div class="loading">Loading validation data...</div>
        </div>

        <footer>
            <p>Data: 100 randomly sampled Hippo pathway images vs 239 KEGG + 984 WikiPathways</p>
            <p><a href="index.html">Hippo Reference Comparison</a> | <a href="../pathway-alignment/">Pathway Alignment</a> | <a href="../../">Home</a></p>
        </footer>
    </div>

    <script>
        let data = null;
        let currentDb = 'kegg';

        async function loadData() {
            try {
                const response = await fetch('validation_data.json');
                data = await response.json();
                render();
            } catch (e) {
                document.getElementById('content').innerHTML =
                    '<div class="loading">Error loading data: ' + e.message + '</div>';
            }
        }

        function setDb(db) {
            currentDb = db;
            render();
        }

        function render() {
            const s = data.summary;
            const isKegg = currentDb === 'kegg';

            const top1Pct = isKegg ? s.kegg_hippo_is_top1_pct : s.wiki_hippo_is_top1_pct;
            const top5Pct = isKegg ? s.kegg_hippo_in_top5_pct : s.wiki_hippo_in_top5_pct;
            const avgRank = isKegg ? s.avg_kegg_hippo_rank : s.avg_wiki_hippo_rank;
            const totalPaths = isKegg ? s.total_kegg_pathways : s.total_wiki_pathways;
            const hippoPaths = isKegg ? s.kegg_hippo_pathways : s.wiki_hippo_pathways;

            const top1Class = top1Pct >= 70 ? 'stat-good' : top1Pct >= 50 ? 'stat-warn' : 'stat-bad';
            const top5Class = top5Pct >= 80 ? 'stat-good' : top5Pct >= 60 ? 'stat-warn' : 'stat-bad';

            // Filter non-hippo matches by current db
            const prefix = isKegg ? 'KEGG:' : 'Wiki:';
            const nonHippoMatches = Object.entries(s.top_non_hippo_matches)
                .filter(([k]) => k.startsWith(prefix))
                .map(([k, v]) => [k.replace(prefix, '').trim(), v]);

            let html = `
                <div class="summary-grid">
                    <div class="summary-card">
                        <h3>Validation Summary</h3>
                        <div class="big-stat">
                            <div class="number ${top1Class}">${top1Pct}%</div>
                            <div class="label">Hippo is #1 match</div>
                        </div>
                    </div>

                    <div class="summary-card">
                        <h3>Ranking Stats</h3>
                        <div class="stat-row">
                            <span class="stat-label">Hippo in top 5</span>
                            <span class="stat-value ${top5Class}">${top5Pct}%</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Avg Hippo rank</span>
                            <span class="stat-value">#${avgRank} / ${totalPaths}</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Total pathways tested</span>
                            <span class="stat-value">${totalPaths}</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Hippo pathways in DB</span>
                            <span class="stat-value">${hippoPaths}</span>
                        </div>
                    </div>

                    <div class="summary-card">
                        <h3>Dataset</h3>
                        <div class="stat-row">
                            <span class="stat-label">Images analyzed</span>
                            <span class="stat-value">${s.total_images}</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Avg genes/image</span>
                            <span class="stat-value">${s.avg_genes_per_image}</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">KEGG pathways</span>
                            <span class="stat-value">${s.total_kegg_pathways}</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">WikiPathways</span>
                            <span class="stat-value">${s.total_wiki_pathways}</span>
                        </div>
                    </div>
                </div>

                <div class="chart-container">
                    <h3>Database Selection</h3>
                    <div class="tabs">
                        <button class="tab ${currentDb === 'kegg' ? 'active' : ''}" onclick="setDb('kegg')">
                            KEGG (${s.kegg_hippo_is_top1_pct}% Hippo #1)
                        </button>
                        <button class="tab ${currentDb === 'wiki' ? 'active' : ''}" onclick="setDb('wiki')">
                            WikiPathways (${s.wiki_hippo_is_top1_pct}% Hippo #1)
                        </button>
                    </div>
                </div>

                ${nonHippoMatches.length > 0 ? `
                <div class="chart-container">
                    <h3>When Hippo Isn't #1, What Is?</h3>
                    <p style="color:#666;margin-bottom:15px;">Top pathways that beat Hippo matches (often biologically related)</p>
                    ${nonHippoMatches.slice(0, 8).map(([name, count]) => {
                        const pct = count / s.total_images * 100;
                        return `
                            <div class="bar-row">
                                <div class="bar-label">${name.substring(0, 50)}${name.length > 50 ? '...' : ''}</div>
                                <div class="bar-track">
                                    <div class="bar-fill bar-other" style="width:${Math.max(pct * 2, 5)}%">
                                        <span>${count} images</span>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
                ` : ''}

                <div class="chart-container">
                    <h3>Image-by-Image Results</h3>
                    <p style="color:#666;margin-bottom:15px;">
                        <span class="badge badge-hippo">Green</span> = Hippo is #1 match,
                        <span class="badge badge-other">Orange</span> = Non-Hippo is #1
                    </p>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>PMC ID</th>
                                    <th>Genes</th>
                                    <th>#1 Match</th>
                                    <th>Jaccard</th>
                                    <th>#2 Match</th>
                                    <th>Hippo Rank</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.images.map(img => {
                                    const top5 = isKegg ? img.kegg_top5 : img.wiki_top5;
                                    const isHippoTop = isKegg ? img.kegg_hippo_is_top : img.wiki_hippo_is_top;
                                    const hippoRank = isKegg ? img.kegg_hippo_rank : img.wiki_hippo_rank;
                                    const rowClass = isHippoTop ? 'hippo-match' : 'non-hippo-match';
                                    const pmcUrl = `https://www.ncbi.nlm.nih.gov/pmc/articles/${img.pmc_id}`;

                                    return `
                                        <tr class="${rowClass}">
                                            <td><a class="pmc-link" href="${pmcUrl}" target="_blank">${img.pmc_id}</a></td>
                                            <td>${img.gene_count}</td>
                                            <td>
                                                ${top5[0].name.substring(0, 35)}${top5[0].name.length > 35 ? '...' : ''}
                                                ${top5[0].is_hippo ? '<span class="badge badge-hippo">Hippo</span>' : ''}
                                            </td>
                                            <td>${(top5[0].jaccard * 100).toFixed(1)}%</td>
                                            <td>${top5[1]?.name.substring(0, 30) || '-'}</td>
                                            <td>${hippoRank ? '#' + hippoRank : '-'}</td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;

            document.getElementById('content').innerHTML = html;
        }

        loadData();
    </script>
</body>
</html>
